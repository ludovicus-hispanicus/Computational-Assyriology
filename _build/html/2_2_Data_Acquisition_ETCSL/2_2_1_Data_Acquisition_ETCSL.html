
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.2 Parsing ETCSL &#8212; Computational Assyriology</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.3 Data Acquisition: CDLI" href="../2_3_Data_Acquisition_CDLI/2_3_0_Data_Acquisition_CDLI.html" />
    <link rel="prev" title="2.2 Data Acquisition: ETCSL" href="2_2_0_Data_Acquisition_ETCSL.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Computational Assyriology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Welcome to Computational Assyriology
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1_Preliminaries/1_Introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../2_Data_Acquisition/2_Data_Acquisition.html">
   2 Data Acquisition
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_Data_Acquisition.html">
     2.1 Data Acquisition: ORACC
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_0_download_ORACC-JSON.html">
       2.1.0 Download ORACC JSON Files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_1_JSON.html">
       2.1.1 The JSON Data Format
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_2_parse-json-cat.html">
       2.1.2 Retrieve ORACC Catalog Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_3_basic_ORACC-JSON_parser.html">
       Extract Lemmatization from ORACC JSON: Basic Parser
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_4_extended_ORACC-JSON_parser.html">
       Extract Lemmatization from JSON: Extended Parser
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_2_0_Data_Acquisition_ETCSL.html">
     2.2 Data Acquisition: ETCSL
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.2 Parsing ETCSL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_3_Data_Acquisition_CDLI/2_3_0_Data_Acquisition_CDLI.html">
     2.3 Data Acquisition: CDLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_3_Data_Acquisition_CDLI/2_3_1_Data_Acquisition_CDLI.html">
     Data Acquisition from CDLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_0_Data_Acquisition_BDTNS.html">
     2.4.1 Data Acquisition BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_1_Data_Acquisition_BDTNS.html">
     2.4 Data Acquision BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_2_Build_Sign_Search.html">
     Build Sign Search for BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_3_Search_BDTNS.html">
     2.4.3 Search BDTNS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_Lexical_and_Literary_Vocabularies.html">
   3. Lexical and Literary Vocabularies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_1_Lit_Lex_Vocab.html">
   3 Overlap in Lexical and Literary Vocabulary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_2_Lit_Lex.html">
   3.2 Overlap in Lexical and Literary Vocabulary: Digging Deeper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_3_Lex-Lit.html">
   3.3 Lexical Texts and their Relation to Literary Vocabulary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_4_Admin_Lex_Vocab.html">
   3.4 Overlap in Lexical and Admin Vocabulary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../4_Networking_Treasure_Archive/4_1_Build-Treasure-network.html">
   Social Network: The Treasure And Shoe Archive from Drehem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../4_Networking_Treasure_Archive/4_2_Analyze_Visualize.html">
   Visualization Functions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/2_2_Data_Acquisition_ETCSL/2_2_1_Data_Acquisition_ETCSL.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/niekveldhuis/compass/master?urlpath=tree/2_2_Data_Acquisition_ETCSL/2_2_1_Data_Acquisition_ETCSL.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/niekveldhuis/compass/blob/master/2_2_Data_Acquisition_ETCSL/2_2_1_Data_Acquisition_ETCSL.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   2.2.1. Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xml-xpath-and-lxml">
     2.2.1.1 XML, Xpath, and lxml
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-and-output">
     2.2.1.2 Input and Output
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up">
   2.2.2 Setting Up
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-libraries">
     2.2.2.1 Load Libraries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-equivalencies">
     2.2.2.2 Load Equivalencies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preprocessing-html-entities">
   2.2.3 Preprocessing: HTML-entities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#marking-secondary-text-and-or-additional-text">
   2.2.4 Marking ‘Secondary Text’ and/or ‘Additional Text’
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transliteration-conventions">
   2.2.5 Transliteration Conventions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#replace-etcsl-by-oracc-lemmatization">
   2.2.6 Replace ETCSL by ORACC Lemmatization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#formatting-words">
   2.2.7 Formatting Words
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#formatting-lines">
   2.2.8 Formatting Lines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sections">
   2.2.9 Sections
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#versions">
   2.2.10 Versions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parse-a-text">
   2.2.11 Parse a Text
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#main-process">
   2.2.12 Main Process
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#save-as-csv">
   2.2.13 Save as CSV
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="parsing-etcsl">
<h1>2.2 Parsing ETCSL<a class="headerlink" href="#parsing-etcsl" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>2.2.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Electronic Text Corpus of Sumerian Literature (<a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a>; 1998-2006) provides editions and translations of 394 Sumerian literary compositions. Goal of this Notebook is to format the [ETCSL] data in such a way that the (lemmatized) texts are made available for computational text analysis. The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> lemmatizations are made compatible with [ORACC] standards (see <a class="reference external" href="http://oracc.org/epsd2/sux">ePSD2</a>), so that <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> and <a class="reference external" href="http://oracc.org">ORACC</a> data can be mixed and matched for text analysis purposes.</p>
<p>The output of this notebook is a <code class="docutils literal notranslate"><span class="pre">csv</span></code> file of lemmatized words (one record is one word) with information about composition, line number, etc.</p>
<p>The original <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> files in <code class="docutils literal notranslate"><span class="pre">TEI</span> <span class="pre">XML</span></code> may be downloaded from the <a class="reference external" href="http://ota.ox.ac.uk/desc/2518">Oxford Text Archive</a> under a Creative Commons Attribution non-Commercial Share-Alike (<a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">BY-NC-SA 3.0</a>) license.</p>
<p>The editors and copyright holders of <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> are: Jeremy Black, Graham Cunningham, Jarle Ebeling, Esther Flückiger-Hawker, Eleanor Robson, Jon Taylor, and Gábor Zólyomi.</p>
<p>The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk/edition2/etcslmanual.php">manual</a> of the <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> project explains in full detail the editorial principles and technical details.</p>
<div class="section" id="xml-xpath-and-lxml">
<h3>2.2.1.1 XML, Xpath, and lxml<a class="headerlink" href="#xml-xpath-and-lxml" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> files as distributed by the <a class="reference external" href="http://ota.ox.ac.uk/desc/2518">Oxford Text Archive</a> are encoded in the <code class="docutils literal notranslate"><span class="pre">TEI</span></code> (Text Encoding Initiative) dialect of <code class="docutils literal notranslate"><span class="pre">XML</span></code> (Extensible Markup Language).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">XML</span></code>tree is parsed in <code class="docutils literal notranslate"><span class="pre">Xpath</span></code>, a language that defines ways in which one can move through an <code class="docutils literal notranslate"><span class="pre">XML</span></code> file and identify particular nodes, sub-nodes, attributes, and elements. The module <code class="docutils literal notranslate"><span class="pre">etree</span></code>of the library <a class="reference external" href="https://lxml.de/"><code class="docutils literal notranslate"><span class="pre">lxml</span></code></a> provides a full implementation of <code class="docutils literal notranslate"><span class="pre">Xpath</span> <span class="pre">1.0</span></code> and is largely compatible with more widely-used libraries such as <code class="docutils literal notranslate"><span class="pre">ElementTree</span></code> and its counterpart <code class="docutils literal notranslate"><span class="pre">cElementTree</span></code>.</p>
</div>
<div class="section" id="input-and-output">
<h3>2.2.1.2 Input and Output<a class="headerlink" href="#input-and-output" title="Permalink to this headline">¶</a></h3>
<p>This scraper expects the following files and directories:</p>
<ol class="simple">
<li><p>Directory <code class="docutils literal notranslate"><span class="pre">etcsl/transliterations/</span></code><br />
This directory should contain the <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> <code class="docutils literal notranslate"><span class="pre">TEI</span> <span class="pre">XML</span></code> transliteration files.</p></li>
<li><p>Directory <code class="docutils literal notranslate"><span class="pre">Equivalencies</span></code><br />
<code class="docutils literal notranslate"><span class="pre">equivalencies.json</span></code>: a set of equivalence dictionaries used at various places in the parser.</p></li>
</ol>
<p>The output is saved in the <code class="docutils literal notranslate"><span class="pre">output</span></code> directory as a single <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file.</p>
</div>
</div>
<div class="section" id="setting-up">
<h2>2.2.2 Setting Up<a class="headerlink" href="#setting-up" title="Permalink to this headline">¶</a></h2>
<div class="section" id="load-libraries">
<h3>2.2.2.1 Load Libraries<a class="headerlink" href="#load-libraries" title="Permalink to this headline">¶</a></h3>
<p>Before running this cell you may need to install the packages <code class="docutils literal notranslate"><span class="pre">lxml</span></code> (for parsing <code class="docutils literal notranslate"><span class="pre">XML</span></code>) and  <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> (for displaying a progress bar). For proper installation of libraries for a Jupyter Notebook see <span class="xref myst">install_packages.ipynb</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">exist_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-equivalencies">
<h3>2.2.2.2 Load Equivalencies<a class="headerlink" href="#load-equivalencies" title="Permalink to this headline">¶</a></h3>
<p>The file <code class="docutils literal notranslate"><span class="pre">equivalencies.json</span></code> contains a number of dictionaries that will be used to search and replace at various places in this notebook. The dictionaries are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">suxwords</span></code>: Sumerian words (Citation Form, GuideWord, and Part of Speech) in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> format and their <a class="reference external" href="http://oracc.org">ORACC</a> counterparts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emesalwords</span></code>: idem for Emesal words</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">propernouns</span></code>: idem for proper nouns</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ampersands</span></code>: HTML entities (such as <code class="docutils literal notranslate"><span class="pre">&amp;aacute;</span></code>) and their Unicode counterparts (<code class="docutils literal notranslate"><span class="pre">á</span></code>; see section 3).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">versions</span></code>: <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> version names and (abbreviated) equivalents</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">equivalencies.json</span></code> file is loaded with the <code class="docutils literal notranslate"><span class="pre">json</span></code> library. The dictionaries <code class="docutils literal notranslate"><span class="pre">suxwords</span></code>, <code class="docutils literal notranslate"><span class="pre">emesalwords</span></code> and <code class="docutils literal notranslate"><span class="pre">propernouns</span></code> (which, together, contain the entire <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> vocabulary) are concatenated into a single dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;equivalencies/equivalencies.json&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">eq</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">equiv</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="s2">&quot;suxwords&quot;</span><span class="p">]</span>
<span class="n">equiv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">eq</span><span class="p">[</span><span class="s2">&quot;emesalwords&quot;</span><span class="p">])</span>
<span class="n">equiv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">eq</span><span class="p">[</span><span class="s2">&quot;propernouns&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="preprocessing-html-entities">
<h2>2.2.3 Preprocessing: HTML-entities<a class="headerlink" href="#preprocessing-html-entities" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> <code class="docutils literal notranslate"><span class="pre">TEI</span> <span class="pre">XML</span></code> files are written in ASCII and represent special characters (such as š or ī) by a sequence of characters that begins with &amp; and ends with ; (e.g. <code class="docutils literal notranslate"><span class="pre">&amp;c;</span></code> represents <code class="docutils literal notranslate"><span class="pre">š</span></code>). The <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library cannot deal with these entities and thus we have to replace them with the actual (Unicode) character that they represent before feeding the data to <code class="docutils literal notranslate"><span class="pre">etree</span></code> module.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">ampersands()</span></code> uses the dictionary <code class="docutils literal notranslate"><span class="pre">ampersands</span></code> for a search-replace action. The dictionary <code class="docutils literal notranslate"><span class="pre">ampersands</span></code> is included in the file <code class="docutils literal notranslate"><span class="pre">equivalencies.json</span></code>, which was loaded above (section 2).</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">ampersands()</span></code> is called in <code class="docutils literal notranslate"><span class="pre">parsetext()</span></code> (see section 11) before the <code class="docutils literal notranslate"><span class="pre">etree</span></code> is built. The regular expression <code class="docutils literal notranslate"><span class="pre">amp</span></code> captures all so-called HTML entities (beginning with a ‘&amp;’ and ending with a ‘;’). The regex is compiled in the main process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ampersands</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>    
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> 
               <span class="n">eq</span><span class="p">[</span><span class="s2">&quot;ampersands&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="marking-secondary-text-and-or-additional-text">
<h2>2.2.4 Marking ‘Secondary Text’ and/or ‘Additional Text’<a class="headerlink" href="#marking-secondary-text-and-or-additional-text" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> web pages include variants, indicated as ‘(1 ms. has instead: )’, with the variant text enclosed in curly brackets. Two types of variants are distinguished: ‘additional text’ and ‘secondary text’. ‘Additional text’ refers to a line that appears in a minority of sources (often in only one) in addition to the majority text. ‘Secondary text’ refers to variant words or variant lines that are found in a minority of sources, replacing the text of the majority sources. The function <code class="docutils literal notranslate"><span class="pre">mark_extra()</span></code> marks each word of ‘secondary text’ or ‘additional text’ by adding the attribute <code class="docutils literal notranslate"><span class="pre">status</span></code> with the value “additional” or “secondary”.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">mark_extra()</span></code> is called twice by the function <code class="docutils literal notranslate"><span class="pre">parsetext()</span></code> (see below, section 11), once for “additional” and once for “secondary” text, indicated by the <code class="docutils literal notranslate"><span class="pre">which</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mark_extra</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;//w[preceding::addSpan[@type=&quot;</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="s1">&quot;]/@to = following::anchor/@id]&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
        <span class="n">word</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">which</span>
    <span class="k">return</span> <span class="n">tree</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="transliteration-conventions">
<h2>2.2.5 Transliteration Conventions<a class="headerlink" href="#transliteration-conventions" title="Permalink to this headline">¶</a></h2>
<p>Transliteration of Sumerian text in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> <code class="docutils literal notranslate"><span class="pre">TEI</span> <span class="pre">XML</span></code> files uses <strong>c</strong> for <strong>š</strong>, <strong>j</strong> for <strong>ŋ</strong> and regular numbers for index numbers. The function <code class="docutils literal notranslate"><span class="pre">tounicode()</span></code> replaces each of those. For example <strong>cag4</strong> is replaced by <strong>šag₄</strong>. This function is called in the function <code class="docutils literal notranslate"><span class="pre">getword()</span></code> to format <code class="docutils literal notranslate"><span class="pre">Citation</span> <span class="pre">Forms</span></code> and <code class="docutils literal notranslate"><span class="pre">Forms</span></code> (transliteration). The function <code class="docutils literal notranslate"><span class="pre">tounicode()</span></code> uses the translation tables <code class="docutils literal notranslate"><span class="pre">transind</span></code> (for index numbers) and <code class="docutils literal notranslate"><span class="pre">transcj</span></code> (for c and j), defined in the main process. The <code class="docutils literal notranslate"><span class="pre">translate()</span></code> function replaces individual characters from a string, according to the table.</p>
<p>In order to replace regular numbers with index numbers the function uses a <a class="reference external" href="https://www.regular-expressions.info/">regular expression</a> to select only those single or double digit numbers that are preceded by a letter (leaving alone the “7” in 7-ta-am3). The regex <code class="docutils literal notranslate"><span class="pre">ind</span></code> is compiled in the main process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tounicode</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">transind</span><span class="p">),</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">transcj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="replace-etcsl-by-oracc-lemmatization">
<h2>2.2.6 Replace <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> by <a class="reference external" href="http://oracc.org">ORACC</a> Lemmatization<a class="headerlink" href="#replace-etcsl-by-oracc-lemmatization" title="Permalink to this headline">¶</a></h2>
<p>For every word, once <code class="docutils literal notranslate"><span class="pre">cf</span></code> (Citation Form), <code class="docutils literal notranslate"><span class="pre">gw</span></code> (Guide Word), and <code class="docutils literal notranslate"><span class="pre">pos</span></code> (Part of Speech) have been pulled out of the <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> <code class="docutils literal notranslate"><span class="pre">XML</span></code> file, they are combined into a lemma and run through the etcsl/oracc equivalence lists to match it with the <a class="reference external" href="http://oracc.org">ORACC</a>/<a class="reference external" href="http://oracc.org/epsd2">ePSD2</a> standards. The equivalence lists are stored in the file <code class="docutils literal notranslate"><span class="pre">equivalencies.json</span></code>, which was loaded above (section 2).</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">etcsl_to_oracc()</span></code> is called by the function <code class="docutils literal notranslate"><span class="pre">getword()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">etcsl_to_oracc</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="n">lemma</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">word</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">word</span><span class="p">[</span><span class="s1">&#39;gw&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">word</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">lemma</span> <span class="ow">in</span> <span class="n">equiv</span><span class="p">:</span>
        <span class="n">word</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>
        <span class="n">alltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;cf2&quot;</span> <span class="ow">in</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">]:</span> <span class="c1"># if an ETCSL word is replaced by two ORACC words</span>
            <span class="n">word2</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">word2</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;cf2&quot;</span><span class="p">]</span>
            <span class="n">word2</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;gw2&quot;</span><span class="p">]</span>
            <span class="n">word2</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="n">lemma</span><span class="p">][</span><span class="s2">&quot;pos2&quot;</span><span class="p">]</span>
            <span class="n">alltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># word not found in equiv</span>
        <span class="n">alltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="formatting-words">
<h2>2.2.7 Formatting Words<a class="headerlink" href="#formatting-words" title="Permalink to this headline">¶</a></h2>
<p>A word in the <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> files is represented by a <code class="docutils literal notranslate"><span class="pre">&lt;w&gt;</span></code> node in the <code class="docutils literal notranslate"><span class="pre">XML</span></code> tree with a number of attributes that identify the <code class="docutils literal notranslate"><span class="pre">form</span></code> (transliteration), <code class="docutils literal notranslate"><span class="pre">citation</span> <span class="pre">form</span></code>, <code class="docutils literal notranslate"><span class="pre">guide</span> <span class="pre">word</span></code>, <code class="docutils literal notranslate"><span class="pre">part</span> <span class="pre">of</span> <span class="pre">speech</span></code>, etc. The function <code class="docutils literal notranslate"><span class="pre">getword()</span></code> formats the word as closely as possible to the <a class="reference external" href="http://oracc.org">ORACC</a> conventions. Three different types of words are treated in three different ways: Proper Nouns, Sumerian words and Emesal words.</p>
<p>In <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> <strong>proper nouns</strong> are nouns (<code class="docutils literal notranslate"><span class="pre">pos</span></code> = “N”), which are qualified by an additional attribute <code class="docutils literal notranslate"><span class="pre">type</span></code> (Divine Name, Personal Name, Geographical Name, etc.; abbreviated as DN, PN, GN, etc.). In <a class="reference external" href="http://oracc.org">ORACC</a> a word has a single <code class="docutils literal notranslate"><span class="pre">pos</span></code>; for proper nouns this is DN, PN, GN, etc. - so what is <code class="docutils literal notranslate"><span class="pre">type</span></code> in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> becomes <code class="docutils literal notranslate"><span class="pre">pos</span></code> in <a class="reference external" href="http://oracc.org">ORACC</a>. <a class="reference external" href="http://oracc.org">ORACC</a> proper nouns usually do not have a guide word (only a number to enable disambiguation of namesakes). The <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> guide words (<code class="docutils literal notranslate"><span class="pre">label</span></code>) for names come pretty close to <a class="reference external" href="http://oracc.org">ORACC</a> citation forms. Proper nouns are therefore formatted differently from other nouns.</p>
<p><strong>Sumerian words</strong> are essentially treated in the same way in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> and <a class="reference external" href="http://oracc.org">ORACC</a>, but the <code class="docutils literal notranslate"><span class="pre">citation</span> <span class="pre">forms</span></code> and <code class="docutils literal notranslate"><span class="pre">guide</span> <span class="pre">words</span></code> are often different. Transformation of citation forms and guide words to <a class="reference external" href="http://oracc.org">ORACC</a>/<a class="reference external" href="http://oracc.org/epsd2/sux">epsd2</a> standards takes place in the function <code class="docutils literal notranslate"><span class="pre">etcsl_to_oracc()</span></code> (see above, section 6).</p>
<p><strong>Emesal words</strong> in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> use their Sumerian equivalents as <code class="docutils literal notranslate"><span class="pre">citation</span> <span class="pre">form</span></code> (attribute <code class="docutils literal notranslate"><span class="pre">lemma</span></code>), adding a separate attribute (<code class="docutils literal notranslate"><span class="pre">emesal</span></code>) for the Emesal form proper. This Emesal form is the one that is used as <code class="docutils literal notranslate"><span class="pre">citation</span> <span class="pre">form</span></code> in the output.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">getword()</span></code> uses the dictionary <code class="docutils literal notranslate"><span class="pre">meta_d</span></code> which has collected all the meta-data (text ID, composition name, version, line number, etc.) of this particular word It produces the dictionary <code class="docutils literal notranslate"><span class="pre">word</span></code> which is sent to the function <code class="docutils literal notranslate"><span class="pre">etcsl_to_oracc()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getword</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">word</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">meta_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">meta_d</span><span class="p">}</span> <span class="c1"># copy all meta data from metad_d into the word dictionary</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;gloss&#39;</span><span class="p">:</span> <span class="c1"># these are Akkadian glosses which are not lemmatized</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(.)&#39;</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># occasionally an Akkadian gloss may consist of multiple lines</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">form</span><span class="p">)</span> <span class="c1"># check - is this needed?</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;string(@lang)&quot;</span><span class="p">)</span>
        <span class="n">alltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@lemma)&#39;</span><span class="p">)</span> <span class="c1"># xpath(&#39;@lemma&#39;) returns a list. The string</span>
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Xbr&#39;</span><span class="p">,</span> <span class="s1">&#39;(X)&#39;</span><span class="p">)</span>  <span class="c1"># function turns it into a single string</span>
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@label)&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;@pos&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@pos)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>         <span class="c1"># if a word is not lemmatized (because it is broken or unknown) add pos = NA and gw = NA</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@form)&#39;</span><span class="p">)</span>
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Xbr&#39;</span><span class="p">,</span> <span class="s1">&#39;(X)&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;@emesal&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@emesal)&#39;</span><span class="p">)</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sux-x-emesal&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">word</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sux&quot;</span>

    <span class="n">exception</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unclear&quot;</span><span class="p">,</span> <span class="s2">&quot;Mountain-of-cedar-felling&quot;</span><span class="p">,</span> <span class="s2">&quot;Six-headed Wild Ram&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;The-enemy-cannot-escape&quot;</span><span class="p">,</span> <span class="s2">&quot;Field constellation&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;White Substance&quot;</span><span class="p">,</span> <span class="s2">&quot;Chariot constellation&quot;</span><span class="p">,</span> 
                 <span class="s2">&quot;Crushes-a-myriad&quot;</span><span class="p">,</span> <span class="s2">&quot;Copper&quot;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;@type&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="c1"># special case: Proper Nouns</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@type)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;ideophone&#39;</span><span class="p">:</span>  <span class="c1"># special case in the special case: skip ideophones</span>
            <span class="n">word</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@type)&#39;</span><span class="p">)</span>
            <span class="n">word</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@label)&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exception</span><span class="p">:</span>
                <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@label)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;@status&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">word</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@status)&#39;</span><span class="p">)</span>
    
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">])</span>
    <span class="n">word</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tounicode</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">])</span>
    <span class="n">etcsl_to_oracc</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="formatting-lines">
<h2>2.2.8 Formatting Lines<a class="headerlink" href="#formatting-lines" title="Permalink to this headline">¶</a></h2>
<p>A line may either be an actual line (in Sumerian and/or Akkadian) or a gap (a portion of text lost). Both receive a line reference. A line reference is an integer that is used to keep lines (and gaps) in their proper order.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">getline()</span></code> is called by <code class="docutils literal notranslate"><span class="pre">getsection()</span></code>. If the argument of <code class="docutils literal notranslate"><span class="pre">getline()</span></code> is an actual line (not a gap) it calls <code class="docutils literal notranslate"><span class="pre">getword()</span></code> for every individual word in that line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getline</span><span class="p">(</span><span class="n">lnode</span><span class="p">):</span>
    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_line&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">lnode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;gap&#39;</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">meta_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">,</span> <span class="s2">&quot;text_name&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;id_line&quot;</span><span class="p">]}</span>
        <span class="n">line</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lnode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;string(@extent)&quot;</span><span class="p">)</span>
        <span class="n">alltexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">lnode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//w|.//gloss[@lang=&quot;akk&quot;]&#39;</span><span class="p">):</span>
                        <span class="c1"># get &lt;w&gt; nodes and &lt;gloss&gt; nodes, but only Akkadian glosses</span>
        <span class="n">getword</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sections">
<h2>2.2.9 Sections<a class="headerlink" href="#sections" title="Permalink to this headline">¶</a></h2>
<p>Some <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> compositions are divided into <strong>sections</strong>. That is the case, in particular, when a composition has gaps of unknown length.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">getsection()</span></code> is called by <code class="docutils literal notranslate"><span class="pre">getversion()</span></code> and receives one argument: <code class="docutils literal notranslate"><span class="pre">tree</span></code> (the <code class="docutils literal notranslate"><span class="pre">etree</span></code> object representing one version of the composition). The function updates <code class="docutils literal notranslate"><span class="pre">meta_d</span></code>, a dictionary of meta data. The function <code class="docutils literal notranslate"><span class="pre">getsection()</span></code> checks to see whether a sub-division into sections is present. If so, it iterates over these sections. Each section (or, if there are no sections, the composition/version as a whole) consists of series of lines and/or gaps. The function <code class="docutils literal notranslate"><span class="pre">getline()</span></code> is called to process each line or gap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getsection</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//div1&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if the text is not divided into sections - skip to else:</span>
        <span class="k">for</span> <span class="n">snode</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">snode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@n)&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lnode</span> <span class="ow">in</span> <span class="n">snode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//l|.//gap&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">lnode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">section</span> <span class="o">+</span> <span class="n">lnode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@n)&#39;</span><span class="p">)</span>
                    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>   <span class="c1"># &quot;label&quot; is the human-legible </span>
                <span class="n">getline</span><span class="p">(</span><span class="n">lnode</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lnode</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//l|.//gap&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lnode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                <span class="n">line_no</span> <span class="o">=</span> <span class="n">lnode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(@n)&#39;</span><span class="p">)</span>
                <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_no</span>
            <span class="n">getline</span><span class="p">(</span><span class="n">lnode</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="versions">
<h2>2.2.10 Versions<a class="headerlink" href="#versions" title="Permalink to this headline">¶</a></h2>
<p>In some cases an <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> file contains different versions of the same composition. The versions may be distinguished as ‘Version A’ vs. ‘Version B’ or may indicate the provenance of the version (‘A version from Urim’ vs. ‘A version from Nibru’). In the edition of the proverbs the same mechanism is used to distinguish between numerous tablets (often lentils) that contain just one proverb, or a few, and are collected in the files “Proverbs from Susa,” “Proverbs from Nibru,” etc. (<a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> c.6.2.1 - c.6.2.5).</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">getversion()</span></code> is called by the function <code class="docutils literal notranslate"><span class="pre">parsetext()</span></code> and receives one argument: <code class="docutils literal notranslate"><span class="pre">tree</span></code> (the <code class="docutils literal notranslate"><span class="pre">etree</span></code> object). The function updates<code class="docutils literal notranslate"><span class="pre">meta_d</span></code>, a dictionary of meta-data. The function checks to see if versions are available in the file that is being parsed. If so, the function iterates over these versions while adding the version name to the <code class="docutils literal notranslate"><span class="pre">meta_d</span></code> dictionary. If there are no versions, the version name is left empty. The parsing process is continued by calling <code class="docutils literal notranslate"><span class="pre">getsection()</span></code> to see if the composition/version is further divided into sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getversion</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="n">versions</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//body[child::head]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if the text is not divided into versions - skip &#39;getversion()&#39;:</span>
        <span class="k">for</span> <span class="n">vnode</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">vnode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(head)&#39;</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="s2">&quot;versions&quot;</span><span class="p">][</span><span class="n">version</span><span class="p">]</span>
            <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version</span>
            <span class="n">getsection</span><span class="p">(</span><span class="n">vnode</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">getsection</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parse-a-text">
<h2>2.2.11 Parse a Text<a class="headerlink" href="#parse-a-text" title="Permalink to this headline">¶</a></h2>
<p>The function <code class="docutils literal notranslate"><span class="pre">parsetext()</span></code> takes one xml file (a composition in <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a>) and parses it, calling a variety of functions defined above.</p>
<p>The parsing is done by the <code class="docutils literal notranslate"><span class="pre">etree</span></code> package in the <code class="docutils literal notranslate"><span class="pre">lxml</span></code> library. Before the file can be parsed properly the so-called HTML entities need to be replaced by their Unicode equivalents. This is done by calling the <code class="docutils literal notranslate"><span class="pre">ampersands()</span></code> function (see above, section 3: Preprocessing).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parsetext</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;etcsl/transliterations/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">xmltext</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">xmltext</span> <span class="o">=</span> <span class="n">ampersands</span><span class="p">(</span><span class="n">xmltext</span><span class="p">)</span>          <span class="c1">#replace HTML entities by Unicode equivalents</span>
    
    <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xmltext</span><span class="p">)</span>
    
    <span class="n">tree</span> <span class="o">=</span> <span class="n">mark_extra</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;additional&quot;</span><span class="p">)</span> <span class="c1"># mark additional words with attribute status = &#39;additional&#39;</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">mark_extra</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s2">&quot;secondary&quot;</span><span class="p">)</span>  <span class="c1"># mark secondary words with attribute status = &#39;secondary&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;string(//title)&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; -- a composite transliteration&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;text_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">getversion</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="main-process">
<h2>2.2.12 Main Process<a class="headerlink" href="#main-process" title="Permalink to this headline">¶</a></h2>
<p>The list <code class="docutils literal notranslate"><span class="pre">alltexts</span></code> is created as an empty list. It will be filled with dictionaries, each dictionary representing one word form.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">textlist</span></code> is a list of all the <code class="docutils literal notranslate"><span class="pre">XML</span></code> files with <a class="reference external" href="http://etcsl.orinst.ox.ac.uk">ETCSL</a> compositions in the directory <code class="docutils literal notranslate"><span class="pre">etcsl/transliterations</span></code>. Each file  is sent as an argument to the function <code class="docutils literal notranslate"><span class="pre">parsetext()</span></code>.</p>
<p>The dictionary <code class="docutils literal notranslate"><span class="pre">meta_d</span></code> is created as an empty dictionary. On each level of analysis the dictionary is updated with meta-data, such as text ID, version name, line number, etc.</p>
<p>The list is transformed into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. All missing values (<code class="docutils literal notranslate"><span class="pre">NaN</span></code>) are replaced by empty strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">textlist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;etcsl/transliterations&#39;</span><span class="p">)</span>
<span class="n">textlist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">amp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&amp;[^;]+;&#39;</span><span class="p">)</span> <span class="c1">#regex for HTML entities, used in ampersands()</span>

<span class="n">asccj</span><span class="p">,</span> <span class="n">unicj</span> <span class="o">=</span> <span class="s1">&#39;cjCJ&#39;</span><span class="p">,</span> <span class="s1">&#39;šŋŠŊ&#39;</span>
<span class="n">transcj</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">asccj</span><span class="p">,</span> <span class="n">unicj</span><span class="p">)</span> <span class="c1"># translation table for c &gt; š and j &gt; ŋ</span>

<span class="n">ind</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-zŋḫṣšṭA-ZŊḪṢŠṬ][0-9x]{1,2}&#39;</span><span class="p">)</span> <span class="c1">#regex for sign index nos preceded by a letter</span>
<span class="n">ascind</span><span class="p">,</span> <span class="n">uniind</span> <span class="o">=</span> <span class="s1">&#39;0123456789x&#39;</span><span class="p">,</span> <span class="s1">&#39;₀₁₂₃₄₅₆₇₈₉ₓ&#39;</span>
<span class="n">transind</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">ascind</span><span class="p">,</span> <span class="n">uniind</span><span class="p">)</span> <span class="c1"># translation table for index numbers</span>
<span class="c1"># regex ind and the translation tables transind and transcj are used in tounicode()</span>

<span class="n">alltexts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">textlist</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">files</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ETCSL </span><span class="si">{</span><span class="n">file</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">meta_d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">parsetext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">alltexts</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-as-csv">
<h2>2.2.13 Save as CSV<a class="headerlink" href="#save-as-csv" title="Permalink to this headline">¶</a></h2>
<p>The DataFrame is saved as a <code class="docutils literal notranslate"><span class="pre">CSV</span></code> file named <code class="docutils literal notranslate"><span class="pre">alltexts.csv</span></code> in the directory <code class="docutils literal notranslate"><span class="pre">output</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;output/alltexts.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./2_2_Data_Acquisition_ETCSL"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="2_2_0_Data_Acquisition_ETCSL.html" title="previous page">2.2 Data Acquisition: ETCSL</a>
    <a class='right-next' id="next-link" href="../2_3_Data_Acquisition_CDLI/2_3_0_Data_Acquisition_CDLI.html" title="next page">2.3 Data Acquisition: CDLI</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Niek Veldhuis<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>