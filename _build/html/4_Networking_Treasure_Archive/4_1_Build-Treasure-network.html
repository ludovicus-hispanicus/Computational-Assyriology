
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Social Network: The Treasure And Shoe Archive from Drehem &#8212; Computational Assyriology</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization Functions" href="4_2_Analyze_Visualize.html" />
    <link rel="prev" title="3.4 Overlap in Lexical and Admin Vocabulary" href="../3_Vocabularies/3_4_Admin_Lex_Vocab.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Computational Assyriology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Welcome to Computational Assyriology
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../1_Preliminaries/1_Introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2_Data_Acquisition/2_Data_Acquisition.html">
   2 Data Acquisition
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_Data_Acquisition.html">
     2.1 Data Acquisition: ORACC
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_0_download_ORACC-JSON.html">
       2.1.0 Download ORACC JSON Files
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_1_JSON.html">
       2.1.1 The JSON Data Format
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_2_parse-json-cat.html">
       2.1.2 Retrieve ORACC Catalog Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_3_basic_ORACC-JSON_parser.html">
       2.1.3 Extract Lemmatization from ORACC JSON: Basic Parser
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../2_1_Data_Acquisition_ORACC/2_1_4_extended_ORACC-JSON_parser.html">
       Extract Lemmatization from JSON: Extended Parser
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_2_Data_Acquisition_ETCSL/2_2_0_Data_Acquisition_ETCSL.html">
     2.2 Data Acquisition: ETCSL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_2_Data_Acquisition_ETCSL/2_2_1_Data_Acquisition_ETCSL.html">
     2.2 Parsing ETCSL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_3_Data_Acquisition_CDLI/2_3_0_Data_Acquisition_CDLI.html">
     2.3 Data Acquisition: CDLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_3_Data_Acquisition_CDLI/2_3_1_Data_Acquisition_CDLI.html">
     Data Acquisition from CDLI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_0_Data_Acquisition_BDTNS.html">
     2.4.1 Data Acquisition BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_1_Data_Acquisition_BDTNS.html">
     2.4 Data Acquision BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_2_Build_Sign_Search.html">
     Build Sign Search for BDTNS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_4_Data_Acquisition_BDTNS/2_4_3_Search_BDTNS.html">
     2.4.3 Search BDTNS
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_Lexical_and_Literary_Vocabularies.html">
   3. Lexical and Literary Vocabularies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_1_Lit_Lex_Vocab.html">
   3 Overlap in Lexical and Literary Vocabulary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_2_Lit_Lex.html">
   3.2 Overlap in Lexical and Literary Vocabulary: Digging Deeper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_3_Lex-Lit.html">
   3.3 Lexical Texts and their Relation to Literary Vocabulary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../3_Vocabularies/3_4_Admin_Lex_Vocab.html">
   3.4 Overlap in Lexical and Admin Vocabulary
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Social Network: The Treasure And Shoe Archive from Drehem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_2_Analyze_Visualize.html">
   Visualization Functions
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/4_Networking_Treasure_Archive/4_1_Build-Treasure-network.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/niekveldhuis/compass/master?urlpath=tree/4_Networking_Treasure_Archive/4_1_Build-Treasure-network.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/niekveldhuis/compass/blob/master/4_Networking_Treasure_Archive/4_1_Build-Treasure-network.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Social Network: The Treasure And Shoe Archive from Drehem
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#building-the-network">
     Building the Network
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#import-the-necessary-modules">
       Import the Necessary Modules
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-corpus">
       The Corpus
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-the-corpus">
     Downloading the Corpus
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-parsejson-function">
     The Parsejson function
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#call-the-parser-on-treasury-texts">
     Call the Parser on Treasury Texts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#normalize-year-dates">
   Normalize year dates
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-bdtns-catalog">
     Read BDTNS catalog
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reformat-bdtns-dates-to-cdli-oracc-standard">
     Reformat BDTNS dates to CDLI/ORACC standard.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replace-oracc-cdli-date-by-bdtns-date">
     Replace ORACC/CDLI date by BDTNS date.
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-normalized-year-dates">
     Create normalized year dates
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframe">
   DataFrame
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-lemma-field">
     Creating a Lemma Field
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nodes-and-roles">
   Nodes and Roles
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-typology">
     Document Typology
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harvest-nodes">
     Harvest Nodes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-keywords-and-the-corresponding-roles">
     Define keywords and the corresponding roles
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#determine-the-role-of-each-pn">
     Determine the Role of each PN
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-results-in-a-table-with-links-for-checking">
     Show results in a table with links for checking
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#special-case-replace-lugal-king-by-the-king-s-name">
     Special Case: replace
     <code class="docutils literal notranslate">
      <span class="pre">
       lugal
      </span>
     </code>
     (king) by the king’s name
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-names">
     Merge Names
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-edges">
   Create Edges
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-results-with-links-for-checking">
     Show results with links for checking
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-edges-by-hand">
     Add edges by hand
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drop-duplicate-edges">
     Drop Duplicate Edges
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-edges">
     Merge Edges
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-the-graph">
   Build the Graph
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-initial-directed-graph">
     Create initial Directed Graph
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-graph-for-single-text-or-single-node-ego">
     Display Graph for Single Text or Single Node (Ego)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#display-single-text">
       display_single_text()
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#display-ego">
       display_ego()
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#open-edition-page">
       open_edition_page()
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-and-display-the-widgets">
       Create and Display the Widgets
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-the-graph">
     Save the Graph
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="social-network-the-treasure-and-shoe-archive-from-drehem">
<h1>Social Network: The Treasure And Shoe Archive from Drehem<a class="headerlink" href="#social-network-the-treasure-and-shoe-archive-from-drehem" title="Permalink to this headline">¶</a></h1>
<p>The Treasure and Shoe archive from Drehem (ancient Puzriš-Dagan) is a relatively small archive (&lt; 300 documents) of administrative texts that date to the 21st century BCE and deal with valuable objects (made of metals and valuable stones), leather objects (shoes, boots, etc.) and weapons. The archive was studied in detail by Paola Paoletti in her book <em>Der König und sein Kreis</em> (2012). The present notebook essentially takes the texts edited and studied by Paoletti, assigning roles to personal names in each text and creating edges between actors in the documents. By identifying nodes (people) and edges (connections between people) this notebook creates a social network that may be analyzed with the tools of Social Network Analysis.</p>
<p>The present notebook will create the social network and do some initial plotting. The next notebook will focus on the analysis of the network.</p>
<p>This notebook goes through several steps:</p>
<ul class="simple">
<li><p>Data acquisition</p></li>
<li><p>Data cleaning</p></li>
<li><p>Defining Nodes</p></li>
<li><p>Assigning roles</p></li>
<li><p>Defining edges</p></li>
<li><p>Creating a Network (using NetworkX)</p></li>
</ul>
<p>We will pay much attention to checking the validity of the results. At every stage (identifying nodes, identifying edges, and creating the network) there will be the possibility to see the outcome for one single text with a link to the edition of that text.</p>
<p>Although the treasure archive uses very standardized terminology (keywords), it is not always possible to determine nodes and edges programmatically. We therefore include the option to list edges by hand in a Comma Separated Values file and add those to the edges that were found computationally.</p>
<p>Many of the keywords that determine the roles of actors in Treasury texts are also used in other Puzriš-Dagan files. The structure of the code is such that other archives may be analyzed essentially the same way. Using text groups from other areas or periods will require substantial adaptation of the code, but the structure of the code will be very similar.</p>
<div class="section" id="building-the-network">
<h2>Building the Network<a class="headerlink" href="#building-the-network" title="Permalink to this headline">¶</a></h2>
<div class="section" id="import-the-necessary-modules">
<h3>Import the Necessary Modules<a class="headerlink" href="#import-the-necessary-modules" title="Permalink to this headline">¶</a></h3>
<p>Here we import the modules necessary for data acquisition and data cleaning and for assignment of roles and edges.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span> <span class="c1"># this suppresses a warning about pandas from tqdm</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">statistics</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>    <span class="c1"># for opening web pages</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">util_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../utils&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util_dir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<p>Create necessary directories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jsonzip&#39;</span><span class="p">,</span> <span class="s1">&#39;pickle&#39;</span><span class="p">]</span>
<span class="n">make_dirs</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-corpus">
<h3>The Corpus<a class="headerlink" href="#the-corpus" title="Permalink to this headline">¶</a></h3>
<p>A list of P numbers (text ID numbers) of texts that belong to the Treasure/Shoe archive, adjusted from a file kindly made available by Paolo Paoletti, may be found in the directory <code class="docutils literal notranslate"><span class="pre">csv</span></code>. This list contains some additional information, for instance where a text was published, and to which sub-archive it belongs. The latter information may be used later on to separate the Treasure texts from the leather texts (or to color those differently in a plot).</p>
<p>One of the texts studied in her book still remains unpublished and is therefore not included (this is U.30117). Several additional Treasury texts were published by <a class="reference external" href="https://doi-org.libproxy.berkeley.edu/10.1515/za-2017-0101">Nawalla Al-Mutawalli and Walther Sallaberger 2018</a> and one additional leather text is found in <a class="reference external" href="http://oracc.org/epsd2/admin/ur3/P433582">RSO 83 (2010), 345 text 14</a>. Another leather text was identified among the photographs of texts from the Louvre (<a class="reference external" href="http://oracc.org/epsd2/admin/ur3/P493329">AO 11393</a>) made available on <a class="reference external" href="http://cli.ucla.edu/P493329">CDLI</a>.</p>
<p>The corpus used here is, therefore, not exactly identical to what was used in Paoletti’s book - but it is very close. At the moment of writing the corpus that is being used includes 298 documents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;csv/treasury_shoes2.txt&#39;</span>
<span class="n">tr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
<span class="n">ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tr_df</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">])</span>
<span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="downloading-the-corpus">
<h2>Downloading the Corpus<a class="headerlink" href="#downloading-the-corpus" title="Permalink to this headline">¶</a></h2>
<p>When running this notebook for the first time (or after a major update of the Ur III corpus on <a class="reference external" href="http://oracc.org/epsd2/admin/ur3">epsd2</a>) it is necessary to download the entire Ur III corpus in JSON format. If you already have the file <code class="docutils literal notranslate"><span class="pre">epsd2-admin-ur3.zip</span></code> in the <code class="docutils literal notranslate"><span class="pre">jsonzip</span></code> directory you may comment out the command that does the download, by placing a hashmark (#) in front of it as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#oracc_download([project])</span>
</pre></div>
</div>
<p>Remove the hashmark and run the cell again to download a fresh copy (this is a large file and may take between one and ten minutes, depending on the speed of your computer and your connection).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">project</span> <span class="o">=</span> <span class="s1">&#39;epsd2/admin/ur3&#39;</span>
<span class="c1">#oracc_download([project]);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-parsejson-function">
<h2>The Parsejson function<a class="headerlink" href="#the-parsejson-function" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">parsejson()</span></code> function used here differs in one way from the ones demonstrated in Chapter 2.1. The code looks for a <code class="docutils literal notranslate"><span class="pre">key</span></code> called <code class="docutils literal notranslate"><span class="pre">ftype</span></code> (field type) among the lemmatization data. The only value that <code class="docutils literal notranslate"><span class="pre">ftype</span></code> may take in this corpus is <code class="docutils literal notranslate"><span class="pre">yn</span></code>, indicating that a word is part of a year name. The field <code class="docutils literal notranslate"><span class="pre">ftype</span></code> enables us to easily exclude year names from our analysis. We will, of course, consider the dating of each text (that is part of the metadata). The vocabulary of the year names, however, is irrelevant for understanding the transactions and connections described in this corpus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parsejson</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">meta_d</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">JSONobject</span> <span class="ow">in</span> <span class="n">text</span><span class="p">[</span><span class="s2">&quot;cdl&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s2">&quot;cdl&quot;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span> 
            <span class="n">l</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parsejson</span><span class="p">(</span><span class="n">JSONobject</span><span class="p">,</span> <span class="n">meta_d</span><span class="p">))</span>
        <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span>
            <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;ftype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ftype&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># this picks up YN for year name</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s2">&quot;id_word&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;strict&quot;</span> <span class="ow">in</span> <span class="n">JSONobject</span> <span class="ow">and</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s2">&quot;strict&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;scope&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s2">&quot;id_word&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s2">&quot;ref&quot;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="call-the-parser-on-treasury-texts">
<h2>Call the Parser on Treasury Texts<a class="headerlink" href="#call-the-parser-on-treasury-texts" title="Permalink to this headline">¶</a></h2>
<p>The variable <code class="docutils literal notranslate"><span class="pre">ids</span></code>, created above, holds all the P numbers of the documents we are interested in. This list is used to define the list of files to be extracted from the <code class="docutils literal notranslate"><span class="pre">zip</span></code> file and to be sent to the parser. Otherwise, the code below is identical to the code in Chapter 2.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lemm_l</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">meta_d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;id_text&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;jsonzip/</span><span class="si">{</span><span class="n">project</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.zip&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span> <span class="c1"># get error information</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># and print it</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="c1"># list of all the files in the ZIP file</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span> <span class="c1"># select only those of the treasury/leather archive</span>

<span class="c1"># unzip each relevant file, parse JSON and add data to `lemma_l`.</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">project</span><span class="p">):</span>
    <span class="n">id_text</span> <span class="o">=</span> <span class="n">project</span> <span class="o">+</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> 
    <span class="n">meta_d</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_text</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>           
        <span class="n">lemm_l</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parsejson</span><span class="p">(</span><span class="n">data_json</span><span class="p">,</span> <span class="n">meta_d</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span> <span class="c1"># get error information</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># and print it</span>

<span class="c1"># get the metadata from catalogue.json</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2">/catalogue.json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;members&#39;</span><span class="p">]</span>
<span class="n">cat</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">}</span>
<span class="n">pub</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="n">id_text</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;designation&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_text</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">]</span>

<span class="c1"># create Publication =&gt; P number and vv. dictionaries</span>
<span class="n">pub2p</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pub</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span>
<span class="n">p2pub</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">pub</span><span class="p">))</span>                        
<span class="n">z</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b3e12cbce69c4e689ad26026f5d8e6b4", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
</div>
<div class="section" id="normalize-year-dates">
<h1>Normalize year dates<a class="headerlink" href="#normalize-year-dates" title="Permalink to this headline">¶</a></h1>
<p>In the <a class="reference external" href="http://oracc.org/epsd2/admin/ur3">ORACC</a> metadata the field <code class="docutils literal notranslate"><span class="pre">date_of</span> <span class="pre">origin</span></code> is formatted as <code class="docutils literal notranslate"><span class="pre">Amar-Suen.05.10.03</span></code>, meaning “5th regnal year of Amar-Suen; month 10, day 3”. The <a class="reference external" href="http://oracc.org/epsd2/admin/ur3">ORACC</a> metadata are directly imported from <a class="reference external" href="http://cdli.ucla.edu">CDLI</a>. In general, <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a> metadata tend to be more reliable than <a class="reference external" href="http://cdli.ucla.edu">CDLI</a>. In the following we will take 2 steps: 1. replace the field <code class="docutils literal notranslate"><span class="pre">date_of_origin</span></code> with the date from the <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a> catalog, where available, and 2. add a field <code class="docutils literal notranslate"><span class="pre">normdate</span></code> (year only) where the year is a numerical value between 1 (year 1 of Urnamma) and 108 (year 24 of Ibbi-Suen). This new field will allow selecting data from a range of years. For unknown years (year name broken or not given) we will use the median value.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>king</p></th>
<th class="head"><p>normalized years</p></th>
<th class="head"><p>regnal years</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ur-Namma</p></td>
<td><p>1-18</p></td>
<td><p>18</p></td>
</tr>
<tr class="row-odd"><td><p>Šulgi</p></td>
<td><p>19-66</p></td>
<td><p>48</p></td>
</tr>
<tr class="row-even"><td><p>Amar-Suen</p></td>
<td><p>67-75</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>Šu-Suen</p></td>
<td><p>76-84</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>Ibbi-Suen</p></td>
<td><p>85-108</p></td>
<td><p>24</p></td>
</tr>
</tbody>
</table>
<div class="section" id="read-bdtns-catalog">
<h2>Read BDTNS catalog<a class="headerlink" href="#read-bdtns-catalog" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a> catalog is downloaded from the site as TSV (TAB separated Values) file. The catalog includes the <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a> number, the <a class="reference external" href="http://cdli.ucla.edu">CDLI</a> number (or P number, also used by <a class="reference external" href="http://oracc.org">ORACC</a>), the publication (an abbreviation that refers to a book publication or a journal issue), the museum number, the date (as recorded in the tablet) and the provenance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bdtns_no&#39;</span><span class="p">,</span> <span class="s1">&#39;cdli_no&#39;</span><span class="p">,</span> <span class="s1">&#39;publication&#39;</span><span class="p">,</span> <span class="s1">&#39;museum_no&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;provenance&#39;</span><span class="p">]</span>
<span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;bdtns_metadata/QUERY_catalogue.txt&#39;</span><span class="p">,</span> 
                                   <span class="n">names</span> <span class="o">=</span> <span class="n">columns</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Create a dictionary with P numbers (CDLI numbers) as key, and the date, according to BDTNS, as value.</span>
<span class="n">bdtns_dates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">cdli_no</span><span class="p">,</span> <span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
<span class="n">bdtns_dates</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">bdtns_dates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bdtns_dates</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">}</span> <span class="c1"># select only the entries from the Treasure/leather archive.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reformat-bdtns-dates-to-cdli-oracc-standard">
<h2>Reformat BDTNS dates to CDLI/ORACC standard.<a class="headerlink" href="#reformat-bdtns-dates-to-cdli-oracc-standard" title="Permalink to this headline">¶</a></h2>
<p>The dates in <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a> are formatted in a way that is different from the dates in <a class="reference external" href="http://cdli.ucla.edu">CDLI</a> and ORACC. <code class="docutils literal notranslate"><span class="pre">Amar-Suen.05.10.03</span></code> (CDLI-style) is represented as <code class="docutils literal notranslate"><span class="pre">AS05</span> <span class="pre">-</span> <span class="pre">10</span> <span class="pre">-</span> <span class="pre">03</span></code> in <a class="reference external" href="http://bdtns.filol.csic.es/">BDTNS</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;UN&#39;</span> <span class="p">:</span> <span class="s1">&#39;Urnamma&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;SH&#39;</span> <span class="p">:</span> <span class="s1">&#39;Šulgi&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;AS&#39;</span> <span class="p">:</span> <span class="s1">&#39;Amar-Suen&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;SS&#39;</span> <span class="p">:</span> <span class="s1">&#39;Šū-Suen&#39;</span><span class="p">,</span> 
         <span class="s1">&#39;IS&#39;</span> <span class="p">:</span> <span class="s1">&#39;Ibbi-Suen&#39;</span><span class="p">}</span>
<span class="n">bdtns_dates_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bdtns_dates</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">bdtns_dates_values</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">kings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;XX&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bdtns_dates_values</span><span class="p">]</span>
<span class="n">bdtns_dates_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bdtns_dates_values</span><span class="p">]</span>

<span class="c1"># bdtns_dates is still a dictionary with P numbers as keys, and dates as values - but now the dates are in CDLI/ORACC style.</span>
<span class="n">bdtns_dates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bdtns_dates</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">bdtns_dates_values</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="replace-oracc-cdli-date-by-bdtns-date">
<h2>Replace ORACC/CDLI date by BDTNS date.<a class="headerlink" href="#replace-oracc-cdli-date-by-bdtns-date" title="Permalink to this headline">¶</a></h2>
<p>If there is no corresponding bdtns entry, the CDLI date is left unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">:</span> 
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bdtns_dates</span><span class="p">:</span> 
        <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;date_of_origin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdtns_dates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-normalized-year-dates">
<h2>Create normalized year dates<a class="headerlink" href="#create-normalized-year-dates" title="Permalink to this headline">¶</a></h2>
<p>Define an offset for each king, and add that offset to the regnal year. <code class="docutils literal notranslate"><span class="pre">Amar-Suen.05</span></code> will become 71 (integer). Add the normalized year dates to the <code class="docutils literal notranslate"><span class="pre">cat</span></code> dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reigns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ur-Namma&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
              <span class="s1">&#39;Šulgi&#39;</span> <span class="p">:</span> <span class="mi">18</span><span class="p">,</span> 
              <span class="s1">&#39;Amar-Suen&#39;</span><span class="p">:</span> <span class="mi">66</span><span class="p">,</span> 
              <span class="s1">&#39;Šū-Suen&#39;</span> <span class="p">:</span> <span class="mi">75</span><span class="p">,</span> 
              <span class="s1">&#39;Ibbi-Suen&#39;</span> <span class="p">:</span> <span class="mi">84</span><span class="p">}</span>
<span class="n">normdates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date_of_origin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">king</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">reigns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">king</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="n">normdate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="n">normdates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normdate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normdate</span> <span class="o">=</span> <span class="mi">999</span>
    <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normdate</span>
<span class="n">md</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">normdates</span><span class="p">))</span>  <span class="c1"># median of all known years</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">999</span><span class="p">:</span>
        <span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cat</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;numer of tablets&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;number of tablets per year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4_1_Build-Treasure-network_22_0.png" src="../_images/4_1_Build-Treasure-network_22_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="dataframe">
<h1>DataFrame<a class="headerlink" href="#dataframe" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">parsejson()</span></code> function has filled the list of lists <code class="docutils literal notranslate"><span class="pre">lemm_l</span></code> with data. This list  is read into a DataFrame for further manipulation. We remove commas and spaces from Guide Words and simplify the field <code class="docutils literal notranslate"><span class="pre">id_text</span></code> to read “P433582” instead of “epsd2/admin/ur3/P433582” (all documents derive from <a class="reference external" href="http://oracc.org/epsd2/admin/ur3">epsd2/admin/ur3</a>).</p>
<p>Finally the code adds a field <code class="docutils literal notranslate"><span class="pre">id_line</span></code> (integer) in order to keep track of the lines in a document. Since lines are meaningful units in Sumerian administrative texts, this will be an important tool.</p>
<p>All of these steps are identical (or very similar) to steps explained in Chapter 2.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lemm_l</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">,</span> <span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;id_word&#39;</span><span class="p">,</span> <span class="s1">&#39;id_text&#39;</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;cf&#39;</span><span class="p">,</span> <span class="s1">&#39;gw&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;ftype&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">]</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
<span class="n">words</span><span class="p">[</span><span class="s1">&#39;gw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="s1">&#39;gw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">words</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
<span class="n">words</span><span class="p">[</span><span class="s1">&#39;id_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-lemma-field">
<h2>Creating a Lemma Field<a class="headerlink" href="#creating-a-lemma-field" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">lemma</span></code> field strings Citation Form, Guide Word, and Part of Speech together and is dealt with in the same way as in Chapter 2.1 Words that remain unlemmatized (e.g. because of illegible or broken signs) are represented by their <code class="docutils literal notranslate"><span class="pre">form</span></code> (transliteration) and numbers receive the POS ‘NU’.</p>
<p>In the DataFrame (physical) breaks and text divisions (marked by horizontal rulings on the tablet, blank lines, and the like) are preserved in the field <code class="docutils literal notranslate"><span class="pre">state</span></code>. Such demarcations have their own row in the DataFrame and receive their own line ID, but they do not have data in fields such as <code class="docutils literal notranslate"><span class="pre">form</span></code>. In order to keep track of breaks we will define two different types: logical and physical breaks. The keywords break_physical and break_logical are included in the <code class="docutils literal notranslate"><span class="pre">lemma</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">physical_break</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;illegible&#39;</span><span class="p">,</span> <span class="s1">&#39;traces&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">,</span> <span class="s1">&#39;effaced&#39;</span><span class="p">]</span>
<span class="n">logical_break</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span> <span class="s1">&#39;ruling&#39;</span><span class="p">]</span>
<span class="n">words</span><span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">words</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> <span class="o">+</span> <span class="n">words</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>
<span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[NA]NA&#39;</span>
<span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span> <span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[]NU&#39;</span>
<span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">logical_break</span><span class="p">),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;break_logical&quot;</span>
<span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">physical_break</span><span class="p">),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;break_physical&quot;</span>
<span class="n">words</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>extent</th>
      <th>scope</th>
      <th>state</th>
      <th>id_word</th>
      <th>id_text</th>
      <th>form</th>
      <th>cf</th>
      <th>gw</th>
      <th>pos</th>
      <th>ftype</th>
      <th>label</th>
      <th>id_line</th>
      <th>lemma</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.3.1</td>
      <td>P512773</td>
      <td>3(diš)</td>
      <td></td>
      <td></td>
      <td>n</td>
      <td></td>
      <td>o 1</td>
      <td>3</td>
      <td>3(diš)[]NU</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.3.2</td>
      <td>P512773</td>
      <td>{geš}pisan</td>
      <td>bisaŋ</td>
      <td>basket</td>
      <td>N</td>
      <td></td>
      <td>o 1</td>
      <td>3</td>
      <td>bisaŋ[basket]N</td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.3.3</td>
      <td>P512773</td>
      <td>a₂-an</td>
      <td>aʾan</td>
      <td>handle</td>
      <td>N</td>
      <td></td>
      <td>o 1</td>
      <td>3</td>
      <td>aʾan[handle]N</td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.3.4</td>
      <td>P512773</td>
      <td>uruda</td>
      <td>urud</td>
      <td>copper</td>
      <td>N</td>
      <td></td>
      <td>o 1</td>
      <td>3</td>
      <td>urud[copper]N</td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.3.5</td>
      <td>P512773</td>
      <td>la₂-a</td>
      <td>la</td>
      <td>hang</td>
      <td>V/t</td>
      <td></td>
      <td>o 1</td>
      <td>3</td>
      <td>la[hang]V/t</td>
    </tr>
    <tr>
      <th>5</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.4.1</td>
      <td>P512773</td>
      <td>n</td>
      <td></td>
      <td></td>
      <td>n</td>
      <td></td>
      <td>o 2</td>
      <td>4</td>
      <td>n[]NU</td>
    </tr>
    <tr>
      <th>6</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.4.2</td>
      <td>P512773</td>
      <td>ku₃-babbar</td>
      <td>kugbabbar</td>
      <td>silver</td>
      <td>N</td>
      <td></td>
      <td>o 2</td>
      <td>4</td>
      <td>kugbabbar[silver]N</td>
    </tr>
    <tr>
      <th>7</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.4.3</td>
      <td>P512773</td>
      <td>{na₄}za-gin₃</td>
      <td>zagin</td>
      <td>lapis</td>
      <td>N</td>
      <td></td>
      <td>o 2</td>
      <td>4</td>
      <td>zagin[lapis]N</td>
    </tr>
    <tr>
      <th>8</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.4.4</td>
      <td>P512773</td>
      <td>{d}en-lil₂</td>
      <td>Enlil</td>
      <td>1</td>
      <td>DN</td>
      <td></td>
      <td>o 2</td>
      <td>4</td>
      <td>Enlil[1]DN</td>
    </tr>
    <tr>
      <th>9</th>
      <td></td>
      <td></td>
      <td></td>
      <td>P512773.4.5</td>
      <td>P512773</td>
      <td>{d}nin-lil₂-la₂</td>
      <td>Ninlil</td>
      <td>1</td>
      <td>DN</td>
      <td></td>
      <td>o 2</td>
      <td>4</td>
      <td>Ninlil[1]DN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="nodes-and-roles">
<h1>Nodes and Roles<a class="headerlink" href="#nodes-and-roles" title="Permalink to this headline">¶</a></h1>
<p>In this section instances Proper Nouns (Personal Names, Royal Names, and Divine Names) are identified and each name instance is assigned a role in a transaction (for instance ‘deliverer’). In a next step, two name instances are connected by an edge, where one name instance functions as the source, the other as the target. This way a directed network is created.</p>
<div class="section" id="document-typology">
<h2>Document Typology<a class="headerlink" href="#document-typology" title="Permalink to this headline">¶</a></h2>
<p>Different types of documents will be treated differently. In the Treasure Archive the main document types are Intake, Expenditure, and Transfer.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>type</p></th>
<th class="head"><p>keyword</p></th>
<th class="head"><p>lemma(s)</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Intake</p></td>
<td><p>mu-kuₓ(DU)</p></td>
<td><p>mu.DU[delivery]N</p></td>
<td><p>materials delivered to the administration</p></td>
</tr>
<tr class="row-odd"><td><p>Expenditure</p></td>
<td><p>ba-zi or zi-ga</p></td>
<td><p>zig[rise]V/i</p></td>
<td><p>materials expended by the administration</p></td>
</tr>
<tr class="row-even"><td><p>Transfer</p></td>
<td><p>šu ba-ti</p></td>
<td><p>šu[hand]N teŋ[near]V/i</p></td>
<td><p>materials transfered from one office to another</p></td>
</tr>
</tbody>
</table>
<p>In the great majority of cases they can be identified simply by looking  for the keyword lemmas.</p>
<p>This typology is discussed in much detail in Paoletti’s <em>Der König und sein Kreis</em> (2012), Chapters 2.1 and 3.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">texttype</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
    <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;mu.DU[delivery]N&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;intake&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;zig[rise]V/i&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;expenditure&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;teŋ[near]V/i&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span> 
        <span class="n">ttype</span> <span class="o">=</span> <span class="s1">&#39;transfer&#39;</span>
    <span class="n">texttype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
<span class="n">treasure</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">texttype</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="harvest-nodes">
<h2>Harvest Nodes<a class="headerlink" href="#harvest-nodes" title="Permalink to this headline">¶</a></h2>
<p>For the node list, select Personal Names (PN) and Royal Names (RN) but skip those that appear in Year Names or Seals. Add lugal (king), sukkalmah (prime minister), and nin (queen), because these actors may be mentioned without personal name. Seals and year names are excluded here because the text of a seal or a year name does not directly reflect the transaction that is recorded in the tablet. Seals do include important information about the identity of the sealer (a father’s name, a profession and/or loyalty to a king or another high official). Such information could be harvested for node attributes (but that is not done here). Year names include essential chronological information (that is taken care of elsewhere) - but the proper nouns in year names (the name of the king, or the name of a priestess being elected) are not part of the transaction proper.</p>
<p>The resulting DataFrame (called <code class="docutils literal notranslate"><span class="pre">PNs</span></code>) is a subset of the DataFrame <code class="docutils literal notranslate"><span class="pre">words</span></code> (which has all the words in all the texts of the archive).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unnamed</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lugal[king]N&#39;</span><span class="p">,</span> <span class="s1">&#39;nin[queen]N&#39;</span><span class="p">,</span> <span class="s1">&#39;sukkalmah[official]N&#39;</span><span class="p">}</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PN&#39;</span><span class="p">,</span> <span class="s1">&#39;RN&#39;</span><span class="p">,</span> <span class="s1">&#39;DN&#39;</span><span class="p">]),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">])</span>
<span class="n">actors</span> <span class="o">=</span> <span class="n">unnamed</span> <span class="o">|</span> <span class="n">names</span>
<span class="n">seal</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;seal&#39;</span><span class="p">),</span> <span class="s1">&#39;id_word&#39;</span><span class="p">])</span>
<span class="n">yn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">ftype</span> <span class="o">==</span> <span class="s1">&#39;yn&#39;</span><span class="p">,</span> <span class="s1">&#39;id_word&#39;</span><span class="p">])</span>
<span class="n">exclude</span> <span class="o">=</span> <span class="n">seal</span> <span class="o">+</span> <span class="n">yn</span>
<span class="n">PNs</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">words</span><span class="o">.</span><span class="n">lemma</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">actors</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">words</span><span class="o">.</span><span class="n">id_word</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">exclude</span><span class="p">))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-keywords-and-the-corresponding-roles">
<h2>Define keywords and the corresponding roles<a class="headerlink" href="#define-keywords-and-the-corresponding-roles" title="Permalink to this headline">¶</a></h2>
<p>The accounts use key words to indicate the particular role of each person in a document. Some of these key words (or key phrases, in some instances) follow the Proper Noun, others precede it. Thus when the word <strong>ŋiri[foot]N</strong> immediately precedes a Personal Name, that person is an intermediary (or conveyor). A Personal Name followed by <strong>šu[hand]N teŋ[near]V/i</strong> marks the recipient of goods.</p>
<p>The keywords are associated with a role in two separate dictionaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">key_post</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mu.DU[delivery]N&#39;</span><span class="p">:</span> <span class="s1">&#39;deliverer&#39;</span><span class="p">,</span> <span class="s1">&#39;maškim[administrator]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;representative&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;zig[rise]V/i&#39;</span> <span class="p">:</span> <span class="s1">&#39;expender&#39;</span><span class="p">,</span>
               <span class="s1">&#39;šu[hand]N teŋ[near]V/i&#39;</span><span class="p">:</span> <span class="s1">&#39;recipient&#39;</span> <span class="p">,</span> <span class="s1">&#39;šu[hand]N us[follow]V/t&#39;</span><span class="p">:</span> <span class="s1">&#39;sender&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;la[hang]V/t&#39;</span> <span class="p">:</span> <span class="s1">&#39;weigher&#39;</span>
            <span class="p">}</span>
<span class="n">key_pre</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;ŋiri[foot]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;conveyor&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;arua[offering]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;offerer&#39;</span><span class="p">,</span> <span class="s1">&#39;kišib[seal]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;sealer&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;gabari[copy]N kišib[seal]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;sealer&#39;</span><span class="p">,</span> <span class="s1">&#39;mu.DU[delivery]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;deliverer&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mu[name]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;ki[place]N&#39;</span> <span class="p">:</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;kiŋ[work]N ak[do]V/t&#39;</span> <span class="p">:</span> <span class="s1">&#39;producer&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;niŋgur[property]N&#39;</span> <span class="p">:</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;šag[heart]N la[hang]V/t&#39;</span> <span class="p">:</span> <span class="s1">&#39;weigher&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="determine-the-role-of-each-pn">
<h2>Determine the Role of each PN<a class="headerlink" href="#determine-the-role-of-each-pn" title="Permalink to this headline">¶</a></h2>
<p>The role of a personal name in an administrative texts is determined by keywords before of after the name. The keywords and their corresponding roles are defined in the dictionaries <code class="docutils literal notranslate"><span class="pre">key_post</span></code> and <code class="docutils literal notranslate"><span class="pre">key_pre</span></code> in the preceding cell.</p>
<p>The DataFrame <code class="docutils literal notranslate"><span class="pre">PNs</span></code>, created above, is an extract from the DataFrame <code class="docutils literal notranslate"><span class="pre">words</span></code> and therefore uses the same indexes. If the index of a Personal Name in <code class="docutils literal notranslate"><span class="pre">PNs</span></code> is <code class="docutils literal notranslate"><span class="pre">i</span></code>, then the word before that name is <code class="docutils literal notranslate"><span class="pre">words.loc[i-1]</span></code>.</p>
<p>We iterate over the index numbers in <code class="docutils literal notranslate"><span class="pre">PNs</span></code> to determine which keywords are found before or after. Before doing so we determine the extent of a document by finding the lowest and highest index number with the same <code class="docutils literal notranslate"><span class="pre">id_text</span></code> as the name instance we are dealing with. Similarly, we can define the extent of the line in which the name is found by finding the lowest and highest index number of the words within the document that share the same <code class="docutils literal notranslate"><span class="pre">id_line</span></code>. With these index numbers we can easily see whether a name is in first position in a line (its index equals the lowest index of that line) or what the last word is in the line in which the name instance appears. We can also check to make sure that when we inspect the next line, this line still belongs to the same document. Working with indexes this way is very fast and flexible - we do not have to look up the P number (in <code class="docutils literal notranslate"><span class="pre">id_text</span></code>) every time, or check the <code class="docutils literal notranslate"><span class="pre">id_line</span></code> field.</p>
<p>Because of the structure of Sumerian grammar, keywords that come <em>after</em> the name may be separated from their name instance by one or more positions, as in:</p>
<blockquote>
<div><p>ARAD₂-{d}nanna sukkal-mah maškim			AradNanna the prime minister was representative.</p>
</div></blockquote>
<p>In this example, maškim (representative) is the keyword, sukkal-mah (prime minister) is an attribute of the name.</p>
<p>In practice the keyword is always the last word on the line, or the first on the next line, as in:</p>
<blockquote>
<div><p>lu₂-{d}nanna šagina nag-su{ki}-ke₄ 		LuNanna the military leader of Nagsu
šu ba-ti 								received</p>
</div></blockquote>
<p>Therefore, if the PN is the first word on the line, we can check  to see if the last word on the line is a keyword and, if so, assign a role to the PN, using the  <code class="docutils literal notranslate"><span class="pre">key_post</span></code> dictionary. We can also look at the first word (or two words) of the next line, to see if there is a keyword in that position. Any word following the PN that is not a keyword is considered an attribute (a father’s name, a profession, etc.).</p>
<p>If the PN is not the first word on the line (its index number is higher than the lowest index number of that line), one possibility is that it is preceded by a keyword, as in:</p>
<blockquote>
<div><p>ki lu₂-dingir-ra-ta					from Ludingira</p>
</div></blockquote>
<p>If there is a preceding keyword, we use the <code class="docutils literal notranslate"><span class="pre">key_pre</span></code> dictionary to assign a role. But a PN later in the line may also be the name of a parent (PN1 dumu PN2) or some other relative, or, occasionally, the name of an employer, as in:</p>
<blockquote>
<div><p>giri₃ a-bu-du₁₀ lu₂ a-bu-ni-ka		Conveyor: Abuṭāb the man of Abuni</p>
</div></blockquote>
<p>In the case of Abuni, his name is not preceded by a keyword, but there is another PN earlier in the line. Abuni does not have a role in the document directly, but he is involved indirectly by his relation of authority to Abuṭāb. In such cases the role is defined as ‘relation’.</p>
<p>If none of these methods results in a role assignment, we fall back to default roles. Default roles are different for different document types. Transfer texts (keywords šu ba-ti) and Intake (mu.DU[delivery]N) may record deliveries by multiple people who are not specifically marked with a keyword. The default in those texts is “source”. Expenditure texts (zi-ga or ba-zi) may record expenditures to various people, not marked specifically. Here the default is “recipient”.</p>
<p>The code takes care of a few special cases. If a name is preceded by u[and]CNJ the role of that name is the same as the role of the preceding name. The (infrequent) expression ki PN-še₃ (“to the place of PN”) uses the same keyword ki[place]N as the very common expression ki PN-ta (“from the place of PN”) but has the opposite meaning. Since the morphology (-ta vs. -še₃) is not available in the <code class="docutils literal notranslate"><span class="pre">lemma</span></code> column, we have to use the <code class="docutils literal notranslate"><span class="pre">form</span></code> column to check for such instances. The expression kin ak, which precedes the name of a craftsman (finished work of PN) may be found on the line preceding the name.</p>
<p>Breaks in the text and horizontal rulings have their own entries in the DataFrame <code class="docutils literal notranslate"><span class="pre">words</span></code>, with separate index numbers and a separate <code class="docutils literal notranslate"><span class="pre">id_line</span></code>. This means that while looking for keywords in a preceding or following line the code will never “jump” over such a break. If, for instance, a document has a name instance right before a break and the line right after the break has šu ba-ti, this will not result in the role “recipient” for the name instance because the break is the next line. It is possible that a name instance right before or right after a break does not receive a role because key words are missing - and is then assigned a default role. This is a possible source of errors.</p>
<p>Much of the code here might be used in the same way for other Ur III archives, but it is likely that there will be other keywords and other special cases that one would need to consider.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_attributes</span><span class="p">(</span><span class="n">PN_index</span><span class="p">,</span> <span class="n">last_word_in_line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function takes all the words following a PN on the same line and </span>
<span class="sd">    designates those as attributes of the PN. If there are key words among </span>
<span class="sd">    the words follwoing the PN, those are removed from the attributes. The arguments</span>
<span class="sd">    are the index number of the PN and the index number of the last word</span>
<span class="sd">    in the line in which the PN appears.&quot;&quot;&quot;</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">last_word_in_line</span><span class="p">:</span>  <span class="c1"># PN is not the last word of the line</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">last_word_in_line</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">])</span>   <span class="c1"># all words following a PN in the same line are attributes</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">attr</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">key_post</span><span class="p">]</span>  <span class="c1"># except for keywords</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="k">if</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span> <span class="ow">in</span> <span class="n">key_post</span><span class="p">:</span> <span class="c1"># multi-word keywords are removed</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">attr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_keywords_after</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function checks to see if the last word on the line in which the PN is found</span>
<span class="sd">    is one of the key words in the dictionary key_post. If so, the dictionary is used to </span>
<span class="sd">    assign a role to the PN. The key word may also appear as the first word on the next </span>
<span class="sd">    line. Phrasal key words (consisting of two words) are checked as well. The function takes</span>
<span class="sd">    two arguments: the index number of the PN and the role of the PN (in most cases this role</span>
<span class="sd">    will equal the empty string). The function returns the role.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">role</span> <span class="o">=</span> <span class="n">key_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_word_in_line</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">],</span> <span class="n">role</span><span class="p">)</span>    <span class="c1"># keyword appears in same line in last position</span>
    <span class="n">role</span> <span class="o">=</span> <span class="n">key_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_word_in_line</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">],</span> <span class="n">role</span><span class="p">)</span> <span class="c1"># or in the next line in first position</span>
    <span class="k">if</span> <span class="n">last_word_in_line</span> <span class="o">-</span> <span class="n">first_word_in_line</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># the line has more than two words</span>
        <span class="n">lastwords</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]))</span> <span class="c1"># two-word keywords (as in šu ba-ti)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">key_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lastwords</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nextline</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>               <span class="c1"># two-word keyword appearing in first position in next line</span>
        <span class="n">firstwords</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nextline</span><span class="p">[:</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]))</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">key_post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">firstwords</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">first_word_in_text</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># at least two words preceded the PN in the text</span>
                                    <span class="c1"># special case: if kin ak or ša₃ i₃-la₂ is found on preceding line </span>
        <span class="n">preceding2words</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]))</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">key_pre</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">preceding2words</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">role</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_keywords_before</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function checks to see if the word preceding the PN is a key word in the dictionary key_pre.</span>
<span class="sd">    If so, the dictionary is used to assign a role to the PN. The function considers various</span>
<span class="sd">    special cases, such as two names connected by &#39;and&#39; or two names in a (family) relationship. The function takes</span>
<span class="sd">    two arguments: the index number of the PN and the role of the PN (which may well be the empty </span>
<span class="sd">    string). The function returns the role.&quot;&quot;&quot;</span>
    <span class="n">firstwords</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">first_word_in_line</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]))</span>  <span class="c1"># join all words before PN</span>
    <span class="n">role</span> <span class="o">=</span> <span class="n">key_pre</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">firstwords</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>        <span class="c1"># ŋiri₃ PN; ki PN-ta; kin ak PN; etc</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">first_word_in_line</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ki[place]N&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_word_in_line</span><span class="p">][</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;-še₃&#39;</span><span class="p">):</span> 
        <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;destination&#39;</span>              <span class="c1"># special case: ki PN-še₃         </span>
    <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>                <span class="c1"># role has not been filled yet</span>
        <span class="n">PN</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">first_word_in_line</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PNs</span><span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">])]</span> <span class="c1"># is there another PN previously in the line?</span>
        <span class="k">if</span> <span class="n">PN</span><span class="p">:</span>                                                                  
            <span class="k">if</span> <span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;u[and]CNJ&#39;</span><span class="p">:</span>   <span class="c1"># PN1 u PN2</span>
                <span class="k">if</span> <span class="n">roles</span><span class="p">:</span>
                    <span class="n">role</span> <span class="o">=</span> <span class="n">roles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>               <span class="c1"># same role as previous PN</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;relation&#39;</span>             <span class="c1"># as in PN1 dumu PN2</span>
        <span class="k">elif</span> <span class="n">treasure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Pno</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;expenditure&#39;</span><span class="p">:</span> <span class="c1"># commodities + PN: recipient</span>
            <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;recipient&#39;</span>
        <span class="k">else</span><span class="p">:</span>                              <span class="c1"># if there is no preceding PN: drop the name</span>
            <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>                     <span class="c1"># this may  need refinement</span>
        <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unnamed</span> <span class="ow">and</span> <span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PNs</span><span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">]):</span>  
            <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>       <span class="c1"># &#39;unnamed&#39; person (e.g. sukkalmah) is preceded by name</span>
    <span class="k">return</span> <span class="n">role</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">attribute</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">PNs</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>                           <span class="c1"># the index of PNs is identical to the one of words</span>
<span class="c1"># create variables that that contain indexes for the first and last word in the line in which the PN appears, </span>
<span class="c1"># the first and last word in the text, etc. These indexes are used to find key words before or after the PN</span>
<span class="c1"># Identify the P number (text ID) of the text in which the word appears, as well as the line ID.</span>
<span class="c1"># These variables are used in the functions get_attributes(), check_keywords_after(), and check_keywords_before().</span>
    <span class="n">Pno</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span>                    <span class="c1"># the text ID (P number)</span>
    <span class="n">lineno</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id_line&#39;</span><span class="p">]</span>                 <span class="c1"># the line number in which the name instance appears</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">Pno</span><span class="p">]</span>         <span class="c1"># data frame of the entire text</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">id_line</span> <span class="o">==</span> <span class="n">lineno</span><span class="p">]</span> <span class="c1">#  data frame of the line with the PN</span>
    <span class="n">first_word_in_line</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                 <span class="c1"># index no. of first word in line</span>
    <span class="n">last_word_in_line</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                   <span class="c1"># index no. of last word in line</span>
    <span class="n">first_word_in_text</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>                    <span class="c1"># index no. of first word in text</span>
    <span class="c1">#last_word_in_text = max(text.index)                    # index no. of last word in text</span>
    <span class="n">last_line_in_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">index</span><span class="p">)][</span><span class="s1">&#39;id_line&#39;</span><span class="p">]</span>          <span class="c1"># highest line number in text</span>
    <span class="k">if</span> <span class="n">lineno</span> <span class="o">&lt;</span> <span class="n">last_line_in_text</span><span class="p">:</span>                       <span class="c1"># check that next line is still in the same text</span>
        <span class="n">next_line_id</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_word_in_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;id_line&#39;</span><span class="p">]</span>  <span class="c1"># line id of the word after </span>
                                           <span class="c1"># the last word of the line</span>
        <span class="n">nextline</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">text</span><span class="o">.</span><span class="n">id_line</span> <span class="o">==</span> <span class="n">next_line_id</span><span class="p">]</span>  <span class="c1"># data frame of the words in nextline</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nextline</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># fake nextline: empty data frame</span>

<span class="c1"># first get attributes</span>
    <span class="n">attr</span> <span class="o">=</span> <span class="n">get_attributes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">last_word_in_line</span><span class="p">)</span>

<span class="c1"># now assign roles. Two different scenarios: either the PN is the first word</span>
<span class="c1"># of the line (most likely, keywords will follow), or it is not (most likely, keywords precede).</span>
    <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">first_word_in_line</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>               <span class="c1"># PN in first position</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">check_keywords_after</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
                
    <span class="k">elif</span> <span class="n">first_word_in_line</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>             <span class="c1"># PN appears further in the line with keyword(s) preceding</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">check_keywords_before</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>                                         <span class="c1"># role still empty</span>
        <span class="k">if</span> <span class="n">treasure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Pno</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;expenditure&#39;</span><span class="p">:</span> <span class="c1"># default role for zi-ga/ba-zi texts</span>
            <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;recipient&#39;</span>
        <span class="k">elif</span> <span class="n">treasure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Pno</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;intake&#39;</span><span class="p">,</span> <span class="s1">&#39;transfer&#39;</span><span class="p">]:</span>    <span class="c1"># default role for mu-DU and šu ba-ti texts</span>
            <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;source&#39;</span>
    <span class="n">roles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
    <span class="n">attribute</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
<span class="n">PNs</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roles</span>
<span class="n">PNs</span><span class="p">[</span><span class="s1">&#39;attribute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribute</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-results-in-a-table-with-links-for-checking">
<h2>Show results in a table with links for checking<a class="headerlink" href="#show-results-in-a-table-with-links-for-checking" title="Permalink to this headline">¶</a></h2>
<p>The code in the following two cells does not add or change anything, but allows to check the results. One may inspect the entire output, or restrict it to a certain type of role, or one particular text.</p>
<p>The Pandas <code class="docutils literal notranslate"><span class="pre">style</span></code> method creates links out of properly formated HTML anchor (&lt;a&gt;) tags. The links are made by adding the <code class="docutils literal notranslate"><span class="pre">id_word</span></code> field to the URL for the treasury database. This will highlight the word in question. Note that <code class="docutils literal notranslate"><span class="pre">id_word</span></code> is fairly stable, but not absolutely so. If the text has been edited in such a way that there are more (or less) lines on the object or there are more (or less) words in the line, the highlighting may be off.</p>
<p>Move the slide to see more (or less) results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;&lt;a href=&quot;http://oracc.museum.upenn.edu/epsd2/admin/ur3/</span><span class="si">{}</span><span class="s1">&quot;, target=&quot;_blank&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/a&gt;&#39;</span>
<span class="n">PNs2</span> <span class="o">=</span> <span class="n">PNs</span><span class="p">[[</span><span class="s1">&#39;id_word&#39;</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span><span class="p">,</span> <span class="s1">&#39;id_text&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">PNs2</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">anchor</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">PNs</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]]</span>
<span class="n">roles</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">roles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">PNcols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">PNs2</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">textid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ids</span><span class="p">,</span><span class="n">role</span><span class="o">=</span><span class="n">roles</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">showpns</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">textid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">PNs2</span><span class="p">[:</span><span class="n">rows</span><span class="p">][</span><span class="n">PNcols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">PNs2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PNs2</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">role</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">PNcols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">PNs2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PNs2</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">PNcols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">PNs2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">PNs2</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">role</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PNs2</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">)][:</span><span class="n">rows</span><span class="p">][</span><span class="n">PNcols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6af52ceef3be4aeb8c6f08fc92225a6a", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
<div class="section" id="special-case-replace-lugal-king-by-the-king-s-name">
<h2>Special Case: replace <code class="docutils literal notranslate"><span class="pre">lugal</span></code>(king) by the king’s name<a class="headerlink" href="#special-case-replace-lugal-king-by-the-king-s-name" title="Permalink to this headline">¶</a></h2>
<p>The king is never referred to by name, but alwas as <em>lugal</em> (king). Use the field <code class="docutils literal notranslate"><span class="pre">date_of_origin</span></code> to determine the identity of <em>lugal</em> and replace the lemma <em>lugal[king]N</em> by the appropriate Royal Name (in ORACC style).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kings_oracc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ur-Namma&#39;</span> <span class="p">:</span> <span class="s1">&#39;Urnamma[1]RN&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Šulgi&#39;</span>     <span class="p">:</span> <span class="s1">&#39;Šulgir[1]RN&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Amar-Suen&#39;</span> <span class="p">:</span> <span class="s1">&#39;Amarsuenak[1]RN&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Šū-Suen&#39;</span>   <span class="p">:</span> <span class="s1">&#39;Šusuen[1]RN&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;Ibbi-Suen&#39;</span> <span class="p">:</span> <span class="s1">&#39;Ibbisuen[1]RN&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PNs</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="n">P_no</span><span class="p">][</span><span class="s2">&quot;date_of_origin&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">P_no</span> <span class="ow">in</span> <span class="n">PNs</span><span class="o">.</span><span class="n">id_text</span><span class="p">]</span>
<span class="n">PNs</span><span class="p">[</span><span class="s2">&quot;king&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="n">P_no</span><span class="p">][</span><span class="s2">&quot;date_of_origin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">P_no</span> <span class="ow">in</span> <span class="n">PNs</span><span class="o">.</span><span class="n">id_text</span><span class="p">]</span>
<span class="n">PNs</span><span class="p">[</span><span class="s2">&quot;king&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kings_oracc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">king</span><span class="p">,</span> <span class="s1">&#39;lugal[king]N&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">king</span> <span class="ow">in</span> <span class="n">PNs</span><span class="o">.</span><span class="n">king</span><span class="p">]</span>
<span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PNs</span><span class="o">.</span><span class="n">lemma</span> <span class="o">==</span> <span class="s1">&#39;lugal[king]N&#39;</span><span class="p">,</span> <span class="s2">&quot;lemma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">king</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="merge-names">
<h2>Merge Names<a class="headerlink" href="#merge-names" title="Permalink to this headline">¶</a></h2>
<p>The following names/titles, all refer to the same person: AradNannak[0]PN, Aradnanna[0]PN, Aradŋu[0]PN, and sukkalmah[official]N</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Aradnannak</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Aradnanna[0]PN&#39;</span><span class="p">,</span> <span class="s1">&#39;Aradŋu[0]PN&#39;</span><span class="p">,</span> <span class="s1">&#39;sukkalmah[official]N&#39;</span><span class="p">]</span>
<span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">PNs</span><span class="o">.</span><span class="n">lemma</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">Aradnannak</span><span class="p">),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AradNannak[0]PN&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-edges">
<h1>Create Edges<a class="headerlink" href="#create-edges" title="Permalink to this headline">¶</a></h1>
<p>In order to create edges we need to decide what the direction is of the movement. For instance, goods go from a ‘source’ to a ‘conveyor’ and from there to a ‘recipient’. This example creates two edges:</p>
<blockquote>
<div><p>source =&gt; conveyor </br>
conveyor =&gt; recipient</p>
</div></blockquote>
<p>Each edge is a separate row in a new dataframe, whith four columns: <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>, <code class="docutils literal notranslate"><span class="pre">id_text</span></code>, and <code class="docutils literal notranslate"><span class="pre">edgetype</span></code>.</p>
<p>In order to create an edge we find a name, check its role, and then look for a name with an appropriate role further on in the text. In an Intake document, if we find an <code class="docutils literal notranslate"><span class="pre">conveyor</span></code> (keyword ŋiri₃) we want to find a matching <code class="docutils literal notranslate"><span class="pre">recipient</span></code> (šu ba-ti) - this will be the first PN with role <code class="docutils literal notranslate"><span class="pre">recipient</span></code> after our <code class="docutils literal notranslate"><span class="pre">conveyor</span></code>. If we find a <code class="docutils literal notranslate"><span class="pre">recipient</span></code> we want to find a matching <code class="docutils literal notranslate"><span class="pre">expender</span></code> later in the text. In an Intake document we will not find one, because the <code class="docutils literal notranslate"><span class="pre">recipient</span></code>is found at the end with the keywords šu ba-ti (that edge has already been made when the <code class="docutils literal notranslate"><span class="pre">source</span></code> or the <code class="docutils literal notranslate"><span class="pre">conveyor</span></code> was encountered earlier in the text). In Expenditure documents, however, a list of recipients comes first, each one potentially followed by a <code class="docutils literal notranslate"><span class="pre">representative</span></code> or <code class="docutils literal notranslate"><span class="pre">conveyor</span></code> with an <code class="docutils literal notranslate"><span class="pre">expender</span></code> at the end. By  searching only forwards we avoid making double edges.</p>
<p>This way we can take care of multiple transaction texts, where we may have multiple pairs of “source” and “conveyor” (or “representative”) and one “recipient” at the end, or multiple “recipients” followed by one “expender”.</p>
<p>The one exception is for the role “relation” in a line like:</p>
<blockquote>
<div><p>giri₃ a-bu-du₁₀ lu₂ a-bu-ni-ka		Transporter: Abuṭāb the man of Abuni</p>
</div></blockquote>
<p>Here, Abuni has the role ‘relation’, which always points backwards in the document. The “relation” (here: Abuni) is the Source, and the first name encountered before this one is the Target (here Abuṭāb), whatever its role. Since, in this case, Abuṭāb has the role “conveyor” he will have three edges (<a class="reference external" href="http://oracc.org/epsd2/admin/ur3/P134759">Trouvaille 86</a>):</p>
<blockquote>
<div><p>Abuni  =&gt; Abuṭāb </br>
Šu-Enlil =&gt; Abuṭāb </br>
Abuṭāb =&gt; PuzurErra</p>
</div></blockquote>
<p>Šu-Enlil, who sends his goods through Abuṭāb to PuzurErra, is qualified himself as “son”of the king”, so that he, in turn, will appear in  another edge in which the king is Source, and Šu-Enlil Target.</p>
<p>These edges are of different kinds. By default all edges are of the type “transaction”, except for those that express a relationship (familial or otherwise); those are marked as “relation”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">Pno</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>                              <span class="c1"># one document ID at a time</span>
    <span class="n">people</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">PNs</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">Pno</span><span class="p">]</span>    <span class="c1"># indexes of all the people in that document</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">people</span><span class="p">:</span>                       <span class="c1"># iterate over those indexes</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">people</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span> <span class="c1"># indexes of all other name instances, later in the document</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">edgetype</span> <span class="o">=</span> <span class="s1">&#39;transaction&#39;</span>   <span class="c1"># that is the default</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;conveyor&#39;</span><span class="p">,</span> <span class="s1">&#39;representative&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">treasure</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Pno</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;expenditure&#39;</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
                <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;expender&#39;</span><span class="p">]]</span>  <span class="c1"># look for source after the target</span>
                <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
                <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;recipient&#39;</span><span class="p">,</span> <span class="s1">&#39;sealer&#39;</span><span class="p">]]</span>  <span class="c1"># look for target after the source</span>
                <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>  
        <span class="k">elif</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sender&#39;</span><span class="p">,</span> <span class="s1">&#39;deliverer&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;producer&#39;</span><span class="p">,</span> <span class="s1">&#39;weigher&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">]:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;recipient&#39;</span><span class="p">,</span> <span class="s1">&#39;sealer&#39;</span><span class="p">,</span> <span class="s1">&#39;conveyor&#39;</span><span class="p">]]</span> 
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;relation&#39;</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">people</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
                <span class="n">edgetype</span> <span class="o">=</span> <span class="s1">&#39;relation&#39;</span>
        <span class="k">elif</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;recipient&#39;</span><span class="p">,</span> <span class="s1">&#39;sealer&#39;</span><span class="p">]:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;representative&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;conveyor&#39;</span><span class="p">,</span> <span class="s1">&#39;expender&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;recipient&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;offerer&quot;</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rest</span> <span class="k">if</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;expender&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span> 
                <span class="n">target</span> <span class="o">=</span> <span class="n">PNs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">and</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">Pno</span><span class="p">,</span> <span class="n">edgetype</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="show-results-with-links-for-checking">
<h2>Show results with links for checking<a class="headerlink" href="#show-results-with-links-for-checking" title="Permalink to this headline">¶</a></h2>
<p>The code in the following two cells does not add or change anything, but allows to check the results. In the second cell one may enter a condition to restrict the output to a particular document, or a particular type of edge for instance</p>
<p>The Pandas <code class="docutils literal notranslate"><span class="pre">style</span></code> method creates links out of properly formated HTML anchor (&lt;a&gt;) tags. The links are created by adding the field <code class="docutils literal notranslate"><span class="pre">id_text</span></code> to the URL for the ur3 database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edgs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
<span class="n">edgs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;id_text&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_type&#39;</span><span class="p">]</span>
<span class="n">anchor</span> <span class="o">=</span> <span class="s1">&#39;&lt;a href=&quot;http://oracc.museum.upenn.edu/epsd2/admin/ur3/</span><span class="si">{}</span><span class="s1">&quot;, target=&quot;_blank&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/a&gt;&#39;</span>
<span class="n">edgs_style</span> <span class="o">=</span> <span class="n">edgs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">edgs_style</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">anchor</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">edgs_style</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
<span class="n">target</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="n">source</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_type&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgs_style</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">target</span><span class="p">,</span> <span class="n">textid</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ids</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">showedges</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">textid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="p">[:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">target</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">source</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">source</span><span class="p">)][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">target</span><span class="p">)][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">elif</span> <span class="n">textid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">source</span><span class="p">)][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">edgs_style</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">edgs_style</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="n">source</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">edgs</span><span class="o">.</span><span class="n">id_text</span> <span class="o">==</span> <span class="n">textid</span><span class="p">][:</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "71e20bf66bff414691ed253cfc2a3dc2", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
<div class="section" id="add-edges-by-hand">
<h2>Add edges by hand<a class="headerlink" href="#add-edges-by-hand" title="Permalink to this headline">¶</a></h2>
<p>Complex administrative texts such as UTI 6 3800 (<a class="reference external" href="http://oracc.org/epsd2/P141796">P141796</a>) and Ist PD 912 (<a class="reference external" href="http://oracc.org/epsd2/P332256">P332256</a>), or documents that are badly damaged such AUCT 1 276 (<a class="reference external" href="http://oracc.org/epsd2/P103121">P103121</a>) are not parsed well with the routine above. These edges are collected by hand in the file /edges/add_edges.txt. The routine will note if a node is not currently in the PNs dataframe. If so, this may indicate an error somewhere, or it could simply be a name that had not been recognized so far.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;edges/add_edges.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">add_edges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">add_source</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">add_edges</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">add_target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">add_edges</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">add</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">add_source</span> <span class="o">+</span> <span class="n">add_target</span><span class="p">))</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">add</span><span class="p">:</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">PNs</span><span class="o">.</span><span class="n">lemma</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span> 
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> is not recognized&quot;</span><span class="p">)</span>
<span class="n">replace</span> <span class="o">=</span> <span class="n">add_edges</span><span class="o">.</span><span class="n">id_text</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">edgs</span> <span class="o">=</span> <span class="n">edgs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">edgs</span><span class="o">.</span><span class="n">id_text</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">replace</span><span class="p">)]</span>
<span class="n">edgs</span> <span class="o">=</span> <span class="n">edgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nimgirinimgina[0]PN is not recognized
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="drop-duplicate-edges">
<h2>Drop Duplicate Edges<a class="headerlink" href="#drop-duplicate-edges" title="Permalink to this headline">¶</a></h2>
<p>For various reasons a single document may create duplicate edges. In large summary texts we may encounter the same two people who interact at different points in time and those are true duplicates that should increase the weight of the edge. More common, however, are two other situations. First, illegible or partly legible names may be represented as identical, resulting in multiple transaction between a Mr or Mrs X and a recipient or expender. Second, the same relationship may be expressed multiple times, for instance Me-ištaran dumu-munus lugal (Me-Ištaran the daughter of the king).</p>
<p>For the time being, all duplicate edges are removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edgs</span> <span class="o">=</span> <span class="n">edgs</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="merge-edges">
<h2>Merge Edges<a class="headerlink" href="#merge-edges" title="Permalink to this headline">¶</a></h2>
<p>Edges that connect the same people, but originate in different documents are merged. The number of merged edges becomes the weight of the edge. The field <code class="docutils literal notranslate"><span class="pre">id_text</span></code> now becomes a list of P numbers.</p>
<p>Edges are merged naively, without checking for the possibility of namesakes. This issue is not a big deal in this particular archive, but will need more attention in larger text groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edgs</span><span class="p">[</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;normdate&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edgs</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
<span class="n">edgs_merged</span> <span class="o">=</span> <span class="n">edgs</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;id_text&#39;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;normdate&#39;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
<span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;min_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;normdate&#39;</span><span class="p">]]</span>
<span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;max_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">edgs_merged</span><span class="p">[</span><span class="s1">&#39;normdate&#39;</span><span class="p">]]</span>
<span class="n">edgs_merged</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>target</th>
      <th>edge_type</th>
      <th>id_text</th>
      <th>normdate</th>
      <th>weight</th>
      <th>min_date</th>
      <th>max_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abisimti[0]PN</td>
      <td>Damu[1]DN</td>
      <td>transaction</td>
      <td>[P144477]</td>
      <td>[77]</td>
      <td>1</td>
      <td>77</td>
      <td>77</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Abisimti[0]PN</td>
      <td>Gemenannak[0]PN</td>
      <td>transaction</td>
      <td>[P332256]</td>
      <td>[71]</td>
      <td>1</td>
      <td>71</td>
      <td>71</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Abisimti[0]PN</td>
      <td>Gunura[1]DN</td>
      <td>transaction</td>
      <td>[P144477]</td>
      <td>[77]</td>
      <td>1</td>
      <td>77</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Abisimti[0]PN</td>
      <td>Ninisinak[0]PN</td>
      <td>transaction</td>
      <td>[P144477]</td>
      <td>[77]</td>
      <td>1</td>
      <td>77</td>
      <td>77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Abisimti[0]PN</td>
      <td>Nuhilum[0]PN</td>
      <td>relation</td>
      <td>[P111905]</td>
      <td>[72]</td>
      <td>1</td>
      <td>72</td>
      <td>72</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>495</th>
      <td>ŠuʾEštar[0]PN</td>
      <td>Šulgiʾabi[0]PN</td>
      <td>transaction</td>
      <td>[P127861]</td>
      <td>[69]</td>
      <td>1</td>
      <td>69</td>
      <td>69</td>
    </tr>
    <tr>
      <th>496</th>
      <td>ŠuʾEštar[0]PN</td>
      <td>ŠuʾEštar[0]PN</td>
      <td>transaction</td>
      <td>[P127861]</td>
      <td>[69]</td>
      <td>1</td>
      <td>69</td>
      <td>69</td>
    </tr>
    <tr>
      <th>497</th>
      <td>ṢillušDagan[0]PN</td>
      <td>Ilabuʾigadu[0]PN</td>
      <td>transaction</td>
      <td>[P116199]</td>
      <td>[63]</td>
      <td>1</td>
      <td>63</td>
      <td>63</td>
    </tr>
    <tr>
      <th>498</th>
      <td>ṢillušDagan[0]PN</td>
      <td>PuzurErra[0]PN</td>
      <td>transaction</td>
      <td>[P134759]</td>
      <td>[63]</td>
      <td>1</td>
      <td>63</td>
      <td>63</td>
    </tr>
    <tr>
      <th>499</th>
      <td>ṢillušDagan[0]PN</td>
      <td>Ribagada[0]PN</td>
      <td>transaction</td>
      <td>[P332256]</td>
      <td>[71]</td>
      <td>1</td>
      <td>71</td>
      <td>71</td>
    </tr>
  </tbody>
</table>
<p>500 rows × 8 columns</p>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="build-the-graph">
<h1>Build the Graph<a class="headerlink" href="#build-the-graph" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-initial-directed-graph">
<h2>Create initial Directed Graph<a class="headerlink" href="#create-initial-directed-graph" title="Permalink to this headline">¶</a></h2>
<p>NetworkX may create a network directly from the edgelist that was created in Pandas. The node list is created from the edge list. Node attributes need to be added separately.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">convert_matrix</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">edgs_merged</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> 
                                         <span class="n">edge_attr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;edge_type&#39;</span><span class="p">,</span> <span class="s1">&#39;min_date&#39;</span><span class="p">,</span> <span class="s1">&#39;max_date&#39;</span><span class="p">],</span>
                                        <span class="n">create_using</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodecolors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;PN&#39;</span> <span class="p">:</span> <span class="s1">&#39;#525252&#39;</span><span class="p">,</span> <span class="s1">&#39;DN&#39;</span> <span class="p">:</span><span class="s1">&#39;#00ffff&#39;</span><span class="p">,</span> <span class="s1">&#39;RN&#39;</span> <span class="p">:</span> <span class="s1">&#39;#8469e7&#39;</span><span class="p">}</span>
<span class="n">degree</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span> <span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
<span class="n">edge_size</span> <span class="o">=</span> <span class="p">{(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">:</span> <span class="n">G</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">}</span>
<span class="n">edge_color</span> <span class="o">=</span> <span class="p">{(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span> <span class="s1">&#39;blue&#39;</span> <span class="k">if</span> <span class="n">G</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">][</span><span class="s1">&#39;edge_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;relation&#39;</span> 
                 <span class="k">else</span> <span class="s1">&#39;green&#39;</span> <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">}</span>
<span class="n">eigenvector</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">eigenvector_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="s2">&quot;degree&quot;</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">eigenvector</span><span class="p">,</span> <span class="s2">&quot;eigenvector_centrality&quot;</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color</span><span class="p">,</span> <span class="s2">&quot;edge_color&quot;</span><span class="p">)</span>
<span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_size</span><span class="p">,</span> <span class="s2">&quot;edge_size&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="display-graph-for-single-text-or-single-node-ego">
<h2>Display Graph for Single Text or Single Node (Ego)<a class="headerlink" href="#display-graph-for-single-text-or-single-node-ego" title="Permalink to this headline">¶</a></h2>
<p>In order to check the validity of the process above the code below allows the user to display the network for a single text, or to display the ego-network of a single node. When displaying these sub-networks, one may open the edition or editions of the document(s) involved in <a class="reference external" href="http://oracc.org">ORACC</a> by clicking on a button.</p>
<p>In order to do so we connect a set of widgets with three functions: <code class="docutils literal notranslate"><span class="pre">display_single_text()</span></code>, <code class="docutils literal notranslate"><span class="pre">display_ego()</span></code>, and <code class="docutils literal notranslate"><span class="pre">open_edition_page()</span></code>.</p>
<div class="section" id="display-single-text">
<h3>display_single_text()<a class="headerlink" href="#display-single-text" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">display_single_text()</span></code> function is called when a dropdown menu is changed. There are two such dropdown menus, one where the user may select a P number (the text ID) and one with publication numbers. Publication numbers and ID numbers may be mapped to one another by two dictionaries (<code class="docutils literal notranslate"><span class="pre">p2pub</span></code> and <code class="docutils literal notranslate"><span class="pre">pub2p</span></code>) so that the two dropdowns change in unison.</p>
<p>The function reads the new value of the dropdown in the variable <code class="docutils literal notranslate"><span class="pre">id_text</span></code> and uses that value to filter the edges in the main graph G, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s_edges</span> <span class="o">=</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">id_text</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">G.edges(data=True)</span></code> (or <code class="docutils literal notranslate"><span class="pre">G.edges.data()</span></code>) returns a list of tuples, where each tuple has the format <code class="docutils literal notranslate"><span class="pre">(source,</span> <span class="pre">target,</span> <span class="pre">edge-attributes)</span></code>. The third element of the tuple (the edge attributes) has the form of a dictionary. As a result, <code class="docutils literal notranslate"><span class="pre">s_edges</span></code> is a subset of the edges in G, that only contains the edges that are available in that one single document. Note that the edge attribute “id_text” is a string that may contain more than one P number (because the same source, target combination may be attested in multiple documents). That is why the consition is formed with an <code class="docutils literal notranslate"><span class="pre">in</span></code> expression (<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">id_text</span> <span class="pre">in</span> <span class="pre">a['id_text']</span></code>).</p>
<p>This sub-set of edges is than used to crreate a new (directed) graph. To make the graph more informative we define edge colors (blue for relations and red for transactions) and node colors (purple for human beings and cyan for divine beings). The graph is then drawn as a circular graph (<code class="docutils literal notranslate"><span class="pre">nx.draw_circular()</span></code>; many other layout options are available), specifying labels, node colors, etc. Behind the scenes, the actual drawing is done by matplotlib, so we initiate the figure with <code class="docutils literal notranslate"><span class="pre">plt.figure()</span></code>.</p>
<p>The graph of a single text (or any graph in NetworkX) has a number of characteristics that we can call and print as additional information, including the number of nodes, the number of edges, and the density of the graph (which percentage of the potential number of edges is realized?).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display_single_text</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">dropdown</span><span class="p">:</span> <span class="c1"># if the change came from the first dropdown menu</span>
        <span class="n">id_text</span> <span class="o">=</span> <span class="n">dropdown</span><span class="o">.</span><span class="n">value</span>
        <span class="n">dropdown2</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">dropdown2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p2pub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span> 
        <span class="n">dropdown2</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">dropdown2</span><span class="p">:</span> <span class="c1"># if the change came from the 2nd dropdown menu</span>
        <span class="n">id_text</span> <span class="o">=</span> <span class="n">pub2p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dropdown2</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="n">dropdown</span><span class="o">.</span><span class="n">unobserve</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">id_text</span>
        <span class="n">dropdown</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">pnos</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_text</span>
    <span class="k">if</span> <span class="n">id_text</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>    
        <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="n">s_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">id_text</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">edge_subgraph</span><span class="p">(</span><span class="n">s_edges</span><span class="p">)</span>
    <span class="n">node_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodecolors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;#cc0066&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="n">edge_c</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;edge_color&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span> <span class="c1"># provide margins to prevent labels from going over the edge</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_circular</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">font_size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_c</span><span class="p">,</span> 
                <span class="n">node_color</span><span class="o">=</span><span class="n">node_c</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">clear_output</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span><span class="si">}</span><span class="s2">; Density: </span><span class="si">{</span><span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span><span class="si">:</span><span class="s2"> .4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edges: </span><span class="si">{</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="display-ego">
<h3>display_ego()<a class="headerlink" href="#display-ego" title="Permalink to this headline">¶</a></h3>
<p>This function is called when one of the dropdown menus “Ego” or “radius” is changed. In order to display an Ego network we may use the <code class="docutils literal notranslate"><span class="pre">ego_graph()</span></code> function in NetworkX. The value of Ego (the name of the actor at the center of the Ego network) is read from the dropdown menu (<code class="docutils literal notranslate"><span class="pre">dropdown3</span></code>). The radius defaults to 2, but may get any value between 1 (only direct neighbors) to 10. The P numbers of all the texts that contain this name in an edge are listed in the variable <code class="docutils literal notranslate"><span class="pre">textids</span></code> (a list) and this list is transformed to a single string and assigned to the key “id_text” in the dictionary <code class="docutils literal notranslate"><span class="pre">p_nos</span></code>. This dictionary is used in the function <code class="docutils literal notranslate"><span class="pre">open_edition_page()</span></code> to open one or more texts in <a class="reference external" href="http://oracc.org">ORACC</a>. In the graph, nodes and edges are colored in the same way as in <code class="docutils literal notranslate"><span class="pre">display_single_text()</span></code>. The graph G is a directed graph, but the function <code class="docutils literal notranslate"><span class="pre">ego_graph()</span></code> needs the option <code class="docutils literal notranslate"><span class="pre">undirected</span> <span class="pre">=</span> <span class="pre">True</span></code>, otherwise only outgoing edges are included in the Ego network. This does not change the network itself into an undirected network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display_ego</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="n">Ego</span> <span class="o">=</span> <span class="n">dropdown3</span><span class="o">.</span><span class="n">value</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">dropdown4</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="n">Ego</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">ego_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">Ego</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">undirected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># undirected = False results in an Ego network that</span>
                                                                  <span class="c1"># only includes outgoing edges.</span>
    <span class="n">eigenv</span> <span class="o">=</span> <span class="n">eigenvector</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Ego</span><span class="p">)</span>
    <span class="n">textids</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;id_text&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>   <span class="c1"># id_text is a list, textids is a list of lists</span>
    <span class="n">textids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">textids</span><span class="p">))</span>         <span class="c1"># from_iterable pulls all items from a list of lists</span>
    <span class="n">pnos</span><span class="p">[</span><span class="s2">&quot;id_text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textids</span><span class="p">)</span>
    <span class="n">node_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodecolors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="s1">&#39;#cc0066&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="n">edge_c</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">&#39;edge_color&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span> <span class="c1"># provide margins to prevent labels from going over the edge</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_circular</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">font_size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_c</span><span class="p">,</span> 
                <span class="n">node_color</span><span class="o">=</span><span class="n">node_c</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
        <span class="n">clear_output</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nodes: </span><span class="si">{</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span><span class="si">}</span><span class="s2">; Density: </span><span class="si">{</span><span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span><span class="si">:</span><span class="s2"> .4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edges: </span><span class="si">{</span><span class="n">graph</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span><span class="si">}</span><span class="s2">; Eigenvector Centrality: </span><span class="si">{</span><span class="n">eigenv</span><span class="si">:</span><span class="s2"> .4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Documents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">textids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="open-edition-page">
<h3>open_edition_page()<a class="headerlink" href="#open-edition-page" title="Permalink to this headline">¶</a></h3>
<p>This function is called when one clicks the button “Open Edition in ORACC”. The function reads the key <code class="docutils literal notranslate"><span class="pre">id_text</span></code> in the dictionary <code class="docutils literal notranslate"><span class="pre">pnos</span></code>. The key is initialized with the value “None” (a string). When the functions <code class="docutils literal notranslate"><span class="pre">display_ego()</span></code> or <code class="docutils literal notranslate"><span class="pre">display_single_text()</span></code> are called the key will receive a value that either consists of a single P number, or a sequence of P numbers, separated by commas. This value is used in the URL that is the sole argument of <code class="docutils literal notranslate"><span class="pre">webbrowser.open()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">open_edition_page</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pnos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id_text&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://oracc.museum.upenn.edu/epsd2/admin/ur3/</span><span class="si">{</span><span class="n">pnos</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-and-display-the-widgets">
<h3>Create and Display the Widgets<a class="headerlink" href="#create-and-display-the-widgets" title="Permalink to this headline">¶</a></h3>
<p>The code in the following cell creates the widgets (the dropdown menus etc.), links those to the functions created in the previous cell, and displays the results. The dropdown menus for “Publication” and “Ego” use a custom sort order that ignores case and places the special characters (such as š and ṭ) in the correct position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sortorder</span> <span class="o">=</span> <span class="s2">&quot; []&#39;ʾaāâbcdeēêfgŋhiīîjklmnopqrsṣštṭuūûvwxyz0123456789₀₁₂₃₄₅₆₇₈₉ₓ</span><span class="si">{}</span><span class="s2">[]().-+/~?@×|&amp;&#39;&lt;&gt;,§&quot;</span>
<span class="n">Egos</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">[</span><span class="n">sortorder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">])</span> <span class="c1"># use custom sort order</span>
<span class="n">publications</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pub2p</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">[</span><span class="n">sortorder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">word</span><span class="p">])</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Open Edition in ORACC&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;180px&#39;</span><span class="p">))</span>
<span class="n">button</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">button_color</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span>
<span class="n">dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;None&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ids</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Select Pno&#39;</span><span class="p">)</span>
<span class="n">dropdown2</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;None&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">publications</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Publication&quot;</span><span class="p">)</span>
<span class="n">dropdown3</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;None&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Egos</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Ego&#39;</span><span class="p">)</span>
<span class="n">dropdown4</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Radius&#39;</span><span class="p">)</span>
<span class="n">pnos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id_text&quot;</span> <span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">}</span> <span class="c1"># dictionary for storing P numbers; to be filled by the functions attached to the widgets.</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
<span class="n">dropdown</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">dropdown2</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_single_text</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">dropdown3</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_ego</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">dropdown4</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">display_ego</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">open_edition_page</span><span class="p">)</span>
<span class="n">col1</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">dropdown</span><span class="p">,</span> <span class="n">dropdown2</span><span class="p">,</span> <span class="n">button</span><span class="p">])</span>
<span class="n">col2</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">dropdown3</span><span class="p">,</span> <span class="n">dropdown4</span><span class="p">])</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">])</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">out</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="save-the-graph">
<h2>Save the Graph<a class="headerlink" href="#save-the-graph" title="Permalink to this headline">¶</a></h2>
<p>Save the graph for use in the next notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pickle/treasury.p&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./4_Networking_Treasure_Archive"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../3_Vocabularies/3_4_Admin_Lex_Vocab.html" title="previous page">3.4 Overlap in Lexical and Admin Vocabulary</a>
    <a class='right-next' id="next-link" href="4_2_Analyze_Visualize.html" title="next page">Visualization Functions</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Niek Veldhuis<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>